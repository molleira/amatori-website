!function(){"use strict";var t=JSON.parse(document.currentScript.dataset.data||"null"),e=JSON.parse(document.currentScript.dataset.items||"null"),i=document.createElement("script");i.src="https://www.google-analytics.com/analytics.js",i.async=!0,document.head.appendChild(i),window.ga=window.ga||function(){var t=Array.prototype.slice.call(arguments);return(ga.q=ga.q||[]).push(t)},window.Analytics={properties:[],call_queue:[],test_ids:["UA-4189134-10","UA-4189134-13"],live_ids:["UA-4189134-2","UA-4189134-11"],environments:{0:{sample_rate:100},1:{sample_rate:100,cookie_domain:"staging.bcdevs.com"},2:{sample_rate:8,use_live_ids:!0,cookie_domain:"bandcamp.com"}},dimensions:{LOGIN_STATE:"dimension1",CLIENT_ID:"dimension2"},metrics:{RESPONSE_END_TIME:"metric1",DOM_LOAD_TIME:"metric2",WINDOW_LOAD_TIME:"metric3"},currentCurrency:"USD",data:null,inited:!1,ecommerce:!1,init:function(){if(this.data=t||window.AnalyticsData,this.data&&!this.inited){Identities.bmgr.bands().length>0?this.data.login_state="logged_in_band":Identities.user()?this.data.login_state="logged_in_user":this.data.login_state="not_logged_in";var e=this.environments[this.data.env];this.data.sample_rate=e.sample_rate,this.data.our_ids||(this.data.our_ids=e.use_live_ids?this.live_ids:this.test_ids),this.data.cookie_domain=this.data.domain_match?this.data.cookie_domain||e.cookie_domain:"auto",this.inited=!0;var i=this.data.send_full_url;this.split=window.location.href.split("?"),this.params=this.split[1]&&this.split[1].split("&");var a=[];this.params=this.params&&this.params.filter((function(t){var e="utm_"===t.substr(0,4),n="email="!==t.substr(0,6);return e&&a.push(t.split("=")[0]),i?n:e})),a.length>0&&HiddenParams.hide(a);var n=0;this.data.our_ids.forEach((function(t){this.properties.push(this.createPropertySendPageview(t,!0,n)),n++}),this),this.data.band_id&&this.createPropertySendPageview(this.data.band_id,!1,n),this.collectClientIds(),this.sendCheckoutItems(),this.sendTimings(),this.processQueuedEvents()}},createPropertySendPageview:function(t,e,i){var a=(e?"bandcamp_":"band_")+i,n={name:a};e&&(n.cookieDomain=this.data.cookie_domain,n.sampleRate=this.data.sample_rate),ga("create",t,n);var s={id:t,ours:e,name:a,call:function(){var t=Array.prototype.slice.call(arguments);t[0]=s.name+"."+t[0],ga.apply(window,t)}};if(s.call("set","anonymizeIp",!0),s.call("set","forceSSL",!0),s.call("set","transport","beacon"),e&&s.call("set",this.dimensions.LOGIN_STATE,this.data.login_state),this.params){var r=this.params.length>0?"?"+this.params.join("&"):"",o=this.data.send_full_url?window.location.pathname+r:window.location.pathname;s.call("set","page",o),s.call("set","location",this.split[0]+r)}return s.call("send","pageview"),s},collectClientIds:function(){var t=this;ga((function(){for(var e=window.Analytics.properties,i=ga.getAll(),a=0;a<i.length;a++)for(var n=i[a].get("trackingId"),s=i[a].get("clientId"),r=0;r<e.length;r++){var o=e[r];o.id===n&&o.call("set",t.dimensions.CLIENT_ID,s)}}))},sendCheckoutItems:function(){var t=e||window.AnalyticsItems;if(t&&0!=t.length){var i={};t.forEach((function(t){(i[t.payment_id]=i[t.payment_id]||[]).push(t)}));var a=!1;if("undefined"!=typeof URLSearchParams){var n=Url.parseQuery(window.location.search);a=n&&n.always_send_txns}for(var s="analytics_processed_ids",r=JSON.parse(localStorage.getItem(s)||"[]"),o=[],c=0,d=Object.keys(i);c<d.length;c++)(a||-1===r.indexOf(d[c]))&&o.push(d[c]);if(0!=o.length){var l={};o.forEach((function(t){i[t].forEach((function(t){var e=t.txn_id.slice();delete t.payment_id,delete t.txn_id,null==l[e]&&(l[e]=[]),l[e].push(t)}))})),this.requireEcommerce();var u=this;Object.keys(l).forEach((function(t){l[t].forEach((function(t){u.setCurrency(t.currency),delete t.currency,u.callOurProperties("ec:addProduct",t)})),u.callOurProperties("ec:setAction","purchase",{id:t})})),r=r.slice(Math.max(r.length-1e3,0)),localStorage.setItem(s,JSON.stringify(r.concat(o)))}}},sendTimings:function(){if(window.performance&&window.performance.timing)if("complete"==document.readyState){var t,e=performance.timing,i=e.navigationStart,a=Math.round(e.responseEnd-i),n=Math.round(e.domContentLoadedEventStart-i),s=Math.round(e.loadEventStart-i);if(t=!0,[a,n,s].forEach((function(e){(e<=0||e>=1e6)&&(t=!1)})),t){var r={eventCategory:"Navigation Timing",eventAction:"track",nonInteraction:!0};r[this.metrics.RESPONSE_END_TIME]=a,r[this.metrics.DOM_LOAD_TIME]=n,r[this.metrics.WINDOW_LOAD_TIME]=s,this.callOurProperties("send","event",r)}}else window.addEventListener("load",(function(){window.Analytics.sendTimings()}))},processQueuedEvents:function(){for(;this.call_queue.length>0;)this.callOurProperties.apply(this,this.call_queue.shift())},callOurProperties:function(){var t=Array.prototype.slice.call(arguments);this.inited?this.properties.forEach((function(e){e.ours&&e.call.apply(null,t)})):this.call_queue.push(t)},setCurrency:function(t){t&&t!=this.currentCurrency&&(this.callOurProperties("set","currencyCode",t),this.currentCurrency=t)},cartItemEvent:function(t,e){var i="add"==t;this.requireEcommerce(),this.setCurrency(e.currency),this.callOurProperties("ec:addProduct",{id:e.item_type+e.item_id,name:e.item_title,category:e.item_type,price:e.unit_price,variant:e.is_gift?"gift":"_none",quantity:e.quantity}),this.callOurProperties("ec:setAction",i?"add":"remove"),this.callOurProperties("send","event","Checkout",i?"add_to_cart":"remove_from_cart",e.item_type,e.item_id)},requireEcommerce:function(){this.ecommerce||(this.callOurProperties("require","ec"),this.ecommerce=!0)}},window.Analytics.init()}();
