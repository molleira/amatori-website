var LogAll=function(t,e){for(var i=new Date,n=i.getMilliseconds().toString();n.length<3;)n="0"+n;var a=i.toTimeString().substring(0,8)+"."+n+":",r=Array.prototype.slice.call(arguments,1);if(r.unshift(a),"undefined"!=typeof LogView&&LogView.add(r.join(" ")),"undefined"!=typeof console){var s=console[t]||console.log;s.apply(console,r)}};LogAll.proxy=function(t){return function(e){try{var i=Array.prototype.slice.call(arguments);i.unshift(t),LogAll.apply(Log,i)}catch(t){}}};var ErrorCollector,Log={debug:LogAll.proxy("log"),info:LogAll.proxy("info"),note:LogAll.proxy("info"),warn:LogAll.proxy("warn"),error:LogAll.proxy("error"),server:function(t,e,i){e=e||"info";var n="/client_log",a=new FormData;a.append("exc",i?"1":"0"),a.append("msg",t.substring(0,1e3)),a.append("lvl",e),a.append("r",Math.random().toString().substring(2));var r=document.body.classList.contains("staging");if(navigator.sendBeacon&&!r)Log.debug("server log "+e+": "+t),navigator.sendBeacon(n,a);else{Log.debug("(image beacon) about to send server log entry: "+e+": "+t),a.append("old","1");var s=document.createElement("img");s.style.display="none",s.onload=function(){try{Log.debug("server log entry success: "+e+": "+t),s.onload=s.onerror=null,s=null}catch(t){}},s.onerror=function(){try{Log.debug("server log entry error: "+e+": "+t),s.onload=s.onerror=null,s=null}catch(t){}};var o=new URLSearchParams(a);s.src=n+"?"+o.toString(),s=null}}},U={trim:function(t){return $.trim(t)},isObject:function(t){return $.isPlainObject(t)},augmentObject:function(t,e,i){if(i)for(var n in i){var a=i[n];t[a]=e[a]}else for(var r in e)t[r]=e[r]},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isArray:function(t){return $.isArray(t)},elt:function(t){return U.isString(t)?(t=t.replace(/\./g,"\\."),$("#"+t.toString()).get(0)):$(t).get(0)},stopEvent:function(t){var e=$.Event(t);e.stopPropagation(),e.preventDefault()},pagedataBlob:function(){return window.PagedataBlob||$("#pagedata").data("blob")||{}}};function $assert(t,e){if(!t){null==e&&(e="");confirm("Assertion failed. "+e+"\n\nSelect Cancel to debug.")}}ErrorCollector=function(t){var e={enabled:!0,sampleRate:null,maxBatchSize:3,maxBatches:3,saveDelay:5e3},i=[],n=0,a=0,r=0,s=null,o="";for(var l in e)e.hasOwnProperty(l)&&!t.hasOwnProperty(l)&&(t[l]=e[l]);function u(){if(clearTimeout(s),s=null,c()&&i.length){for(var e=[],r=Math.min(i.length,t.maxBatchSize),o=0;o<r;o++)e.push(i[o].join("\t"));Log.server(e.join("\n"),"debug",!0),n=(new Date).getTime(),i.length=0,a++}}function c(){return t.enabled&&a<t.maxBatches}return t.enabled&&null!=t.sampleRate&&Math.random()>t.sampleRate?(Log.debug("ErrorCollector: disabled due to sample rate"),t.enabled=!1):Log.debug("ErrorCollector: "+(t.enabled?"enabled":"disabled")),window.$&&(o=0,$(document).ready((function(){o=1}))),t.add=function(e,a,l){if((window.isDebug||window.Identities&&window.Identities.isAdmin())&&alert("JavaScript error: "+e+". Check the console."),c()){var h=function(t,e,i){if(!t)return null;if("[object Event]"==t.toString()){t=t.message||t.msg||t.toString(),e=e||t.filename||t.file||"";var n=function(t){return 0===t?new Number(0):t};i=n(i)||n(t.lineno)||n(t.line)||""}if(e){var a=Url.toHash(e).host,s=location.host;if(!a)return null;if(!/(^|\.)(bandcamp\.com|bcbits\.com)$/.test(a)){var l=s.length-a.length;if(l<0||s.lastIndexOf(a)!=l)return null}}if("gecko"==Browser.type&&0==i&&(/Permission denied to access property 'toString'/.test(t)||/Location\.toString/.test(t)))return null;var u=location.href;e==u&&(u="---");var c=[],h=window._jsb;if(h){for(var d=Math.min(h.length,20),p=0;p<d;p++)c.push(h[p].n+":"+(h[p].c||0));d<h.length&&c.unshift("(omitted "+(h.length-d)+")")}return c=c.join(","),[t,e,i,u,++r,o,c]}(e,a,l);h?(i.push(h),function(){if(!s){var e=Math.max(n+t.saveDelay-(new Date).getTime(),250);s=setTimeout(u,e)}}()):Log.debug("ErrorCollector: skipping runtime error")}},t.enabled&&(window.onerror=t.add),t}(ErrorCollector||{});var Iter={each:function(t,e){var i=0,n=null;for(i=0;t&&i<t.length;i++)if(n=e(t[i]))return n},eachWithIndex:function(t,e){var i=0,n=null;for(i=0;t&&i<t.length;i++)if(n=e(t[i],i))return n},collect:function(t,e){e||(e=function(t){return t});for(var i=t.length,n=new Array(i),a=0;a<i;a++)n[a]=e(t[a]);return n},find:function(t,e){for(var i=t.length,n=0;n<i;n++)if(e(t[n]))return t[n];return null},findAll:function(t,e){for(var i=t.length,n=[],a=0;a<i;a++){var r=t[a];e(r)&&n.push(r)}return n},index:function(t,e){if("function"==typeof t.indexOf)return t.indexOf(e);for(var i=t.length,n=0;n<i;n++)if(t[n]==e)return n;return-1},reduce:function(t,e,i){"use strict";if("function"==typeof t.reduce)return arguments.length<3?t.reduce(e):t.reduce(e,i);var n=i,a=0,r=t.length;if(arguments.length<3){for(;a<r&&!(a in t);)a++;if(a>=r)throw new TypeError("Reduce of empty array with no initial value");n=t[a++]}for(;a<r;a++)a in t&&(n=e(n,t[a],a,t));return n}},Text={notEmpty:function(t){return null!=t&&t.toString().length>0},collate:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(Text.notEmpty(e))return e}return""},escapeHtml:function(t){return(t=t.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},unescapeHtml:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild.nodeValue},markupMatch:function(t,e,i,n,a){var r=a?t.indexOf(e):t.toLowerCase().indexOf(e.toLowerCase());return-1==r?t:[t.substr(0,r),i,t.substr(r,e.length),n,t.substr(r+e.length)].join("")},regexpEscape:function(t){return t.replace(/([\\\^\$\*\+\?\.\,\:\!\|\(\)\[\]\{\}])/g,"\\$1")},truncate:function(t,e,i){return t?(null==e&&(e=50),null==i&&(i=""),t.length<=e?t:i.length>e?"":(e=Math.max(0,e-i.length),t.substr(0,e)+i)):""}},Url={PATTERN_URL:/^(?:(https?\:)\/\/([^\:\/\?#]+)(?:\:(\d+))?)?(\/?[^\?#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,PATTERN_URL_NO_SPACE:/^(?:(https?\:)\/\/([^\:\/\?\s#]+)(?:\:(\d+))?)?(\/?[^\?\s#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,toHash:function(t,e){t=t.trim();var i=Url.PATTERN_URL.exec(t)||[];return e&&(i=Url.PATTERN_URL_NO_SPACE.exec(t)||[]),{href:i[0]||"",protocol:i[1]||"",host:(i[2]||"")+(i[3]?":"+i[3]:""),hostname:i[2]||"",port:i[3]||"",pathname:i[4]||"/",search:i[5]||"",hash:i[6]||""}},fromHash:function(t){$assert(U.isObject(t));var e=[];return t.protocol&&e.push(t.protocol,"//"),t.hostname&&e.push(t.hostname),t.port&&e.push(":",t.port),t.pathname&&e.push(t.pathname),t.search&&e.push(t.search),t.hash&&e.push(t.hash),e.join("")},isLocal:function(t){var e=Url._hashify(t);return e.protocol==location.protocol&&e.host==location.host},isFullyQualified:function(t){var e=Url._hashify(t);return e.protocol&&e.host},equals:function(t,e,i){var n=Url._hashify(t),a=Url._hashify(e);return n.protocol==a.protocol&&n.hostname==a.hostname&&(n.port||80)==(a.port||80)&&n.pathname==a.pathname&&n.search==a.search&&(i||n.hash==a.hash)},fullyQualify:function(t,e){var i=Url._hashify(t);e=e||location;var n=Url._hashify(e);if($assert(!i.protocol&&!i.hostname&&!i.port,"expected a non-qualified URL"),$assert(n.protocol&&n.hostname,"expected a fully-qualified base URL"),$(["protocol","hostname","port"]).each((function(t,e){i[e]=n[e]})),i.pathname){if("/"!=i.pathname.charAt(0)){var a=n.pathname||"/";$assert("/"==a.charAt(0),"expected a fully-qualified base URL path"),"/"==a.charAt(a.length-1)?i.pathname=a+i.pathname:i.pathname=a.replace(/[^\/]+$/,i.pathname)}}else i.pathname="/";return Url.fromHash(i)},parseQuery:function(t){var e={};return $.each(Url.parseQueryArray(t),(function(){e[this.name]=this.value})),e},joinQuery:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({name:i,value:t[i]});return Url.joinQueryArray(e)},parseQueryArray:function(t){t=t.replace(/^[\?&\s]*(.*?)[&\s]*$/,"$1");var e=[];if(t){var i=t.split(/&+/);$.each(i,(function(){if(this&&"="!=this){var t,i,n=this.split("=");try{t=decodeURIComponent(n[0]),i=n[1]?decodeURIComponent(n[1]):""}catch(t){return Log.error("parseQueryArray: error when decoding URL parameter, skipping; ",t),!0}e.push({name:t,value:i})}}))}return e},joinQueryArray:function(t){t=t||[];for(var e,i=[],n=0;n<t.length;n++)(e=t[n])&&null!=e.name&&""!=e.name&&(i.length&&i.push("&"),i.push(encodeURIComponent(e.name)),null!=e.value&&""!=e.value&&i.push("=",encodeURIComponent(e.value)));return i.join("")},addQueryParams:function(t,e){if(!e)return t;var i=t.indexOf("?")+1,n=i>0?t.substr(i):"",a=Url.parseQuery(n);for(var r in e)a[r]=e[r];return(i>0?t.substring(0,i):t+"?")+Url.joinQuery(a)},removeQueryParams:function(t,e){if(!e)return t;var i=t.indexOf("?")+1,n=i>0?t.substr(i):"",a=Url.parseQuery(n),r=0;for(var s in e)delete a[e[s]],r+=1;return 0===r?t:(i>0?t.substring(0,i):t+"?")+Url.joinQuery(a)},getQueryParam:function(t,e){var i=Url.toHash(t);return Url.parseQuery(i.search)[e]},_hashify:function(t){return U.isString(t)?Url.toHash(t):t},isCustomDomain:function(t){$assert(window.siteroot,"expected siteroot");var e=t||location.hostname;return!new RegExp("\\.?"+Url.toHash(siteroot).hostname.replace(/\./g,"\\.")+"$").test(e)}},elt=U.elt,LangUtils={makeclass:function(t){return LangUtils.makesubclass(null,t)},makesubclass:function(t,e){var i=function(){};for(var n in e.ctor&&(i=e.ctor,e.ctor=null),t&&$.extend(i,t),e.prototype)i.prototype[n]=e.prototype[n];for(var n in e.statics)i[n]=e.statics[n];return i}},EventSender=LangUtils.makeclass({ctor:function(){this._listeners=[]},prototype:{get_adder:function(){var t=this;return function(e,i){t._listeners.push({callback:e,target:i})}},get_remover:function(){var t=this;return function(e,i){for(var n=0;n<t._listeners.length;)t._listeners[n].callback==e&&t._listeners[n].target==i?t._listeners.splice(n,1):n++}},fire:function(){for(var t=0;t<this._listeners.length;t++){var e=this._listeners[t];try{e.callback.apply(e.target,arguments)}catch(t){Log.debug("exception caught in event handler: "+e.callback.toString())}}}},statics:{create:function(t,e){var i=new EventSender;return i.serial=EventSender.serial++,t["on"+e]=i.get_adder(),t["remove_on"+e]=i.get_remover(),function(){i.fire.apply(i,arguments)}},serial:1}}),Form={_classDefinition:1,_allowSubmit:!1,_submitTimer:null,delaySubmitUntilReady:function(t,e,i,n){n||(n=100);var a="event: "+t.type+", delay_interval: "+n+", change_ui: "+typeof i;Log.debug("delaySubmitUntilReady: "+a),Form._allowSubmit||(U.stopEvent(t),i&&i(),e?(fn=Form.makeSubmitClosure(n,e),Form._submitTimer=setTimeout(fn,n)):alert("The page is still loading; please wait just a moment..."))},makeSubmitClosure:function(t,e){return function(){if(Log.debug("anon fn: delay interval: "+t),Form._submitTimer&&clearTimeout(Form._submitTimer),Form._allowSubmit)Log.debug("Allowing Submit"),e(null,!0);else{Log.debug("delaying "+t+" millis...");var i=Form.makeSubmitClosure(t,e);Form._submitTimer=setTimeout(i,t)}}}};window.HTML5Player=function(){"use strict";function t(t,e){this.buffer=[],this.flushInterval=e||1e4,this.tag=Math.round(Math.random()*Math.pow(2,32)).toString(16),this.name=t||"DebugLog",this.enable()}t.prototype.log=function(t){for(var e=new Date,i=e.getMilliseconds().toString();i.length<3;)i="0"+i;var n=e.toTimeString().substring(0,8)+"."+i;this.buffer.push(n+" : "+t)},t.prototype.flush=function(){if(this.buffer.length>0){Log.debug("DebugLog flushing "+this.buffer.length+" messages to server");var t=this.buffer;this.buffer=[];var e={tag:this.tag,name:this.name,messages:t};$.ajax({url:"/api/debug/1/clientlog",type:"post",data:JSON.stringify(e),dataType:"json",success:function(t){Log.debug("posted client log")},failure:function(t){Log.error("failed to post client log: "+t)}})}},t.prototype.disable=function(){this.interval&&(window.clearInterval(this.interval),this.interval=null),this.flush()},t.prototype.enable=function(){this.interval||(this.interval=window.setInterval(this.flush.bind(this),this.flushInterval),this.interval=null)};var e=1;function i(){var n=Browser.platform,r=Browser.make,o=(Browser.type,Cookie.get("volume"));if(o&&(o=parseFloat(o,10)),this._id=e,e++,this._options={debug:!1,simulateEndedAndroid:"chrome"==r&&"android"==n,safeLoad:"androidbrowser"==r&&"android"==n,playKick:"androidbrowser"==r&&"android"==n&&Browser.version[0]<4,loadStartKick:"androidbrowser"==r&&"android"==n&&Browser.version[0]>=4,deferPlayEvents:("chrome"==r||"androidbrowser"==r)&&"android"==n||"iphone"==n,retryErrors:!0,volume:o||.7,deferredSeeks:!1,resetOnStall:!1,reloadOnSeek:!1,simulateEndedSafari:!1},i.logEnabled()&&(this._debugLog=new t("HTML5Player"),this._options.debug=!0),window.Url){var l=Url.parseQuery(location.search);for(var u in this._options)if(l.hasOwnProperty(u))if("volume"==u){var c=parseFloat(l[u]);c&&(this._options[u]=c)}else this._options[u]=!("0"==l[u]||"false"==l[u])}if(this._handlers={state:[],time:[],loaded:[],info:[],volume:[]},this._listeners=[],this._volume=this._options.volume,this._recentpos=[],this._options.debug){var h=["constructed; options: "];for(var d in this._options)h.push(d,"=",this._options[d],"; ");this._info(h.join(""))}if(this._createmedia(),this._changestate(s),"iphone"==Browser.platform){var p=this;window.addEventListener("popstate",(function(){var t=p._recentpos;if(p._state==a&&t.length&&(p.pause(),t.length>1&&0===t[t.length-1]&&t[t.length-2]>0)){var e=t[t.length-2];p._warn("detected iOS page navigation bug; resetting playhead position to "+e),p._fire_event("time",{position:e}),t.pop()}}))}this._options.safeLoad&&(this._nativeLoad=this._nativeLoadSafe)}i.prototype={load:function(t){this._debug("load()"),this._stallcount=0,this._errorRetryCount=0,this._loadedurl=t,this._wantstoplay=!1,this._recentpos.length=0,h||(this._nativePause(),this._nativeLoad(),this._changestate(n),this._nativeSrc(t),this._nativeLoad(),this._finishedloading=!1,this._loadStartKicked=!1,this._playingEventDeferred=!1)},play:function(){this._debug("play()"),h?window.location=this._loadedurl:this._wantstoplay||(this._wantstoplay=!0,this._nativePlay())},pause:function(){this._debug("pause()"),this._cancelPlayKick(),this._wantstoplay=!1,this._nativePause()},playpause:function(){switch(this._debug("playpause()"),this._state){case a:case n:this.pause();break;default:this.play()}},stop:function(){this._debug("stop()"),this._cancelPlayKick(),this._wantstoplay=!1,this._nativePause()},seek:function(t){this._debug("seek() to "+t);var e=!1,i=this;if(this._options.reloadOnSeek&&"&nl=1"!=this._mediaElem.src.substring(this._mediaElem.src.length-5)){for(var r=!1,s=0;s<this._mediaElem.buffered.length;s++)if(this._mediaElem.buffered.start(s)<=t&&t<=this._mediaElem.buffered.end(s)){r=!0;break}if(!r){this._debug("refreshing with non-rate-limited URL"),this._nativePause(),this._nativeSrc(this._mediaElem.src+"&nl=1");var o=function(e){this.removeEventListener("loadedmetadata",o),i._nativeSeek(t),i._nativePlay()};this._mediaElem.addEventListener("loadedmetadata",o,!1),this._nativeLoad(),e=!0}}if(!e)if(this._options.deferredSeeks)switch(this._wantstoplay=!0,this._state){case a:case n:this._debug("doing deferred seek during playback"),this._wantseek=!0,this._wantpos=t;break;default:this._seek_inner(t)}else this._seek_inner(t)},_seek_inner:function(t){if(this.position()==t)this._debug("seek: new position ("+t+") matches current, so taking no action");else try{this._nativeSeek(t)}catch(t){this._warn("caught error seeking -- perhaps your downloader does not support byte ranges? "+t)}this.play()},position:function(){return this._mediaElem&&this._mediaElem.currentTime},state:function(){return this._state},setrate:function(t){this._mediaElem.playbackRate=t},vol_up:function(){this.setvol(this._volume+.05)},vol_down:function(){this.setvol(this._volume-.05)},setvol:function(t){if(t>1?t=1:t<0&&(t=0),this._volume!=t){this._volume=t,this._debug("setting media element volume to "+this._volume);try{this._mediaElem.volume=this._volume}catch(t){this._warn("caught exception setting volume: "+t)}}this._fire_event("volume",{volume:this._volume})},getvol:function(){return this._volume},onstate:function(t){this._add_event_handler("state",t)},ontime:function(t){this._add_event_handler("time",t)},onloaded:function(t){this._cancelReset(),this._add_event_handler("loaded",t)},oninfo:function(t){this._add_event_handler("info",t)},onvolume:function(t){this._add_event_handler("volume",t)},enableLog:function(e){if(e){this._options.debug=!0;Cookie.set("PlayerDebugLog",(new Date).valueOf()+6048e5),this._debugLog||(this._debugLog=new t("HTML5Player"))}else Cookie.clear("PlayerDebugLog"),this._debugLog&&(this._debugLog.disable(),this._debugLog=null)},_createmedia:function(){if(this._mediaElem=document.createElement("audio"),this._mediaElem.style.width="0px",this._mediaElem.style.height="0px",this._mediaElem.style.visibility="hidden",this._mediaElem.controls=!1,document.body.appendChild(this._mediaElem),this._options.debug)for(var t=0;t<this._loggedEvents.length;t++)this._logevt(this._loggedEvents[t]);this._mediaElem.volume=this._volume,this._addlistener("loadstart",this._handle_loadstart,this),this._addlistener("timeupdate",this._handle_timeupdate,this),this._addlistener("progress",this._handle_progress,this),this._addlistener("canplay",this._handle_canplay,this),this._addlistener("canplaythrough",this._handle_canplay,this),this._addlistener("durationchange",this._handle_durationchange,this),this._addlistener("playing",this._handle_playing,this),this._addlistener("pause",this._handle_pause,this),this._addlistener("ended",this._handle_ended,this),this._addlistener("stalled",this._handle_stalled,this),this._addlistener("waiting",this._handle_waiting,this),this._addlistener("error",this._handle_error,this)},_loggedEvents:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],_logevt:function(t){this._addlistener(t,this._loghandler(t),this)},_destroymedia:function(){this._removelisteners(),this._mediaElem&&(document.body.removeChild(this._mediaElem),this._nativePause(),this._mediaElem=null)},_addlistener:function(t,e,i){var n=function(){e.apply(i,arguments)};this._listeners.push({name:t,handler:n}),this._mediaElem.addEventListener(t,n,!1)},_removelisteners:function(){if(this._mediaElem)for(;this._listeners.length>0;){var t=this._listeners.pop();this._mediaElem.removeEventListener(t.name,t.handler,!1)}},_handle_loadstart:function(t){var e=this._mediaElem;this._options.loadStartKick&&!this._loadStartKicked&&1==e.duration&&4==e.readyState&&(this._loadStartKicked=!0,this._warn("loadstart: looks like Android Browser duration=1 bug; kicking media.src..."),this._nativeSrc(e.src))},_handle_waiting:function(t){this._debug("waiting")},_handle_timeupdate:function(t){try{var e=this._mediaElem;this._options.deferredSeeks&&this._wantseek&&(this._debug("applying deferred seek"),this._seek_inner(this._wantpos),this._wantseek=!1),this._cancelPlayKick(),5==this._recentpos.length&&this._recentpos.shift(),this._recentpos.push(e.currentTime),this._playingEventDeferred&&this._state==n&&(this._warn("Play event was deferred; simulating it now..."),this._playingEventDeferred=!1,this._handle_playing_inner());var i={position:e.currentTime};if(isFinite(e.duration)&&e.duration>0&&(i.duration=e.duration),this._fire_event("time",i),this._options.simulateEndedSafari&&this._mediaElem.ended&&this._handle_ended_inner(),!this._finishedloading){var a=this._amountLoaded();a>=e.duration&&(this._finishedloading=!0),a!=this._lastloaded&&(this._lastloaded=a,i={loaded:a},isFinite(e.duration)&&(i.total=e.duration),this._cancelReset(),this._fire_event("loaded",i))}}catch(t){this._warn("exception in _handle_timeupdate: "+t)}},_handle_progress:function(){var t=this._mediaElem;if(this._options.simulateEndedAndroid&&this._state==a&&!t.paused&&!t.ended&&!isNaN(t.duration)){var e=function(t){return Math.round(1e3*t)},i=e(t.currentTime),n=e(t.duration),r=e(this._amountLoaded());i>0&&i===n&&i===r&&(this._warn("Did we just hit the Chrome/Android bug in which the 'ended' event isn't fired?"),this._warn("Compensating by simulating the event ourselves..."),this._handle_ended_inner())}},_handle_ended:function(){this._debug("_handle_ended"),this._options.simulateEndedSafari||this._handle_ended_inner()},_handle_ended_inner:function(){this._debug("_handle_ended_inner");try{this._wantstoplay=!1,this._changestate(o)}catch(t){this._warn("exception in _handle_ended: "+t)}},_scheduleReset:function(t){if(this._options.resetOnStall){this._cancelReset();var e=this;this._warn("scheduling media reset in "+t+"ms"),this._resetTimer=setTimeout((function(){e._resetTimer=null,e._warn("Resetting media (amtloaded = "+e._amountLoaded()+")"),e._nativeLoad()}),t)}},_cancelReset:function(){this._options.resetOnStall&&this._resetTimer&&(this._warn("canceling media reset due to load progress (amtloaded = "+this._amountLoaded()+")"),clearTimeout(this._resetTimer),this._resetTimer=null)},_schedulePlayKick:function(t){if(this._options.playKick){this._cancelPlayKick();var e=this;this._warn("scheduling playkick in "+t+"ms"),this._playKickTimer=setTimeout((function(){e._warn("kicking"),e._playKickTimer=null,e._nativePause(),e._nativePlay(),e._warn("kicked")}),t)}},_cancelPlayKick:function(){this._options.playKick&&this._playKickTimer&&(this._warn("canceling playkick timer"),clearTimeout(this._playKickTimer),this._playKickTimer=null)},_amountLoaded:function(){return this._mediaElem.buffered.length>0?this._mediaElem.buffered.end(this._mediaElem.buffered.length-1):0},_handle_stalled:function(){this._mediaElem.readyState!=u&&(this._stallcount+=1,this._stallcount>c?(this._error("Too many stalls.  Giving up on this track."),this._nativePause(),this._changestate(o)):(this._debug("stalled, readyState="+this._mediaElem.readyState+", amtloaded="+this._amountLoaded()),this._scheduleReset(7500)))},_handle_playing:function(){this._options.deferPlayEvents&&this._state==n?(this._debug("deferring play event to the next timeupdate"),this._playingEventDeferred=!0):this._handle_playing_inner()},_handle_playing_inner:function(){try{this._changestate(a)}catch(t){this._warn("exception in _handle_playing_inner: "+t)}},_handle_pause:function(){this._state!==o||!this._options.simulateEndedSafari&&!this._options.simulateEndedAndroid?this._mediaElem.paused&&this._changestate(r):this._debug("ignoring 'pause' event because state is COMPLETED")},_handle_canplaythrough:function(){this._handle_canplay()},_handle_canplay:function(){try{this._wantstoplay&&this._nativePlay()}catch(t){this._warn("exception in _handle_canplay: "+t)}},_is_cloud_streaming_url:function(){var t=Url.toHash(this._mediaElem.src).pathname.split("/");if(5==t.length&&""==t[0]&&"stream"==t[1]){var e=parseInt(t[4],10);return NaN!=e?e:null}return null},_is_stream_redirect_url:function(){var t=Url.toHash(this._mediaElem.src).pathname.split("/");return 2===t.length&&"stream_redirect"===t[1]},_refresh_cloud_streaming_url:function(){var t=this,e=this._mediaElem.src,i=this._mediaElem.currentTime;$.ajax({url:"/api/stream/1/refresh",type:"get",data:{url:e},dataType:"json",success:function(e){t._is_cloud_streaming_url()==e.track_id&&(t._nativeSrc(e.url),t._nativeLoad(),t._nativeSeek(i))}})},_reload_stream_redirect_url:function(){var t=this._mediaElem.currentTime;this._nativeSrc(this._mediaElem.src),this._nativeSeek(t)},_handle_error:function(t){var e=this._mediaElem.error&&this._mediaElem.error.code;(this._error("got native error event; error.code="+e),this._options.retryErrors)&&(e!=this._mediaElem.error.MEDIA_ERR_SRC_NOT_SUPPORTED&&e!=this._mediaElem.error.MEDIA_ERR_NETWORK||(this._errorRetryCount<5?(this._errorRetryCount+=1,this._warn("assuming error is due to an expired stream URL and reloading; count="+this._errorRetryCount),null!=this._is_cloud_streaming_url()?this._refresh_cloud_streaming_url():this._is_stream_redirect_url()&&this._reload_stream_redirect_url()):(this._warn("exceeded maximum number of error retries; giving up on this track"),this._nativePause(),this._changestate(o))))},_handle_durationchange:function(){this._schedulePlayKick(500)},_loghandler:function(t){var e=this;return function(){var i=e._mediaElem,n=null;try{n=i.buffered.end(i.buffered.length-1)}catch(t){}this._debug("[native] "+t+"; paused="+i.paused+"; ended="+i.ended+"; readyState="+i.readyState+"; duration="+i.duration+"; currentTime="+i.currentTime+"; buffered="+n)}},_isbuffering:function(){try{return this._mediaElem.readyState<l}catch(t){}return!1},_changestate:function(t){if(t==a&&this._isbuffering()&&(t=n),t!=this._state){var e=this._state;this._state=t,this._debug("state changed from "+e+" to "+t),this._fire_event("state",{newstate:this._state,oldstate:e})}},_fire_event:function(t,e){var i=this._handlers[t];if(i)for(var n=0;n<i.length;n++)try{i[n](this,e)}catch(e){this._warn('caught exception in handler for event "'+t+'": '+e)}},_add_event_handler:function(t,e){this._handlers[t].push(e)},_nativeSrc:function(t){this._debug("[native] setting src to: "+t),this._mediaElem.src=t},_nativeLoad:function(){this._debug("[native] load()"),this._mediaElem.load()},_nativeLoadSafe:function(){this._debug("[native] load() -- with exception handling");try{this._mediaElem.load()}catch(t){this._warn("Got exception when calling native load() -- assuming this is okay and continuing: "+t)}},_nativePlay:function(){this._debug("[native] play()"),this._mediaElem.play()},_nativePause:function(){this._debug("[native] pause()"),this._mediaElem.pause()},_nativeSeek:function(t){this._debug("[native] setting currentTime to: "+t+"; previous position: "+this._mediaElem.currentTime),this._mediaElem.currentTime=t},_debug:function(t){this._options.debug&&this._log("debug",t)},_info:function(t){this._log("info",t)},_warn:function(t){this._log("warn",t)},_error:function(t){this._log("error",t)},_log:function(t,e){this._debugLog&&this._debugLog.log(t.toUpperCase()+" - "+e),void 0!==Log&&Log[t]("HTML5Player-"+this._id+": "+e)}};var n="BUFFERING",a="PLAYING",r="PAUSED",s="IDLE",o="COMPLETED",l=3,u=4,c=20,h=!1;function d(t){for(var e=t.split("."),i=0;i<e.length;i++)e[i]=Number(e[i]);return e}return i.supportedFormats=function(){var t={};if(-1!=navigator.userAgent.indexOf("iPhone")){var e=function(t){var e=t.match(/Version\/([0-9\.]*)/);return e?d(e[1]):null}(navigator.userAgent);if(e&&(e[0]<4||4===e[0]&&0===e[1]&&(2===e.length||0===e[2])))return{}}try{var i=document.createElement("audio"),n=i.canPlayType("audio/mpeg");t["mp3-128"]="probably"==n||"maybe"==n,t["mp3-v0"]="probably"==n||"maybe"==n,n=i.canPlayType('audio/mpeg; codecs="mp4a.40.2"'),t["aac-lo"]="probably"==n||"maybe"==n,t["aac-lo"]||(n=i.canPlayType('audio/mp4; codecs="mp4a.40.2"'),t["aac-lo"]="probably"==n||"maybe"==n),n=i.canPlayType('audio/ogg; codecs="vorbis"'),t["vorbis-lo"]="probably"==n||"maybe"==n,n=i.canPlayType('audio/ogg; codecs="opus"'),t["opus-lo"]="probably"==n||"maybe"==n,t["opus-lo"]&&-1!=navigator.userAgent.indexOf(" Chrome/")&&(t["opus-lo"]=!1)}catch(t){}if(!t){var a=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(a){var r=d(a[1]);(r[0]<2||2==r[0]&&r[1]<3)&&(h=!0,Log.debug("using location <= stream workaround"),t["mp3-128"]=!0,t["aac-lo"]=!0)}}return t},i.needLocationHack=function(){var t=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(!t)return!1;var e=d(t[1]);return e[0]<3||3==e[0]&&e[1]<3},i.enableLog=function(t){t?Cookie.set("PlayerDebugLog",(new Date).valueOf()+6048e5):Cookie.clear("PlayerDebugLog")},i.logEnabled=function(){var t=Cookie.get("PlayerDebugLog");return t&&parseInt(t)>(new Date).valueOf()},i}();var ImageUtils=function(){"use strict";var t={JPEG:"jpg",PNG:"png"};function e(e,n,a,r){if(!n)return TemplGlobals.static_siteroot+"/img/blank.gif";a=i(a);var s,o=ImageUtils.imageRoot(r);return s=a.anim_ok?"":a.file_format&&"original"!=a.file_format?"."+t[a.file_format]:"",o+"/img/"+e+(n=("000000000"+n).slice(-10))+"_"+a.id+s}function i(t){if("object"==typeof t)return t;var e=TemplGlobals.image_formats;if(e)for(var i=0;i<e.length;++i)if(e[i].id==t||e[i].name==t)return e[i];return Log.error("bad image format",t),null}var n={imageURL:function(t,i,n){return e("",t,i,n)},artURL:function(t,i,n){return e("a",t,i,n)},imageFormat:i,imageDimensions:function(t,e,n){var a,r;return(n=i(n))&&"original"!=n.resize_algo?"thumb"==n.resize_algo?(a=n.width,r=n.height):"fit"==n.resize_algo?t<=n.width&&e<=n.height?(a=t,r=e):t/n.width>e/n.height?(a=n.width,r=Math.round(e*(n.width/t))):(a=Math.round(t*(n.height/e)),r=n.height):(Log.error("bad image resize algo",n),a=t,r=e):(a=t,r=e),{width:a,height:r}},imageRoot:function(t){return void 0===t&&(t="https:"===window.location.protocol),t?TemplGlobals.image_siteroot_https:TemplGlobals.image_siteroot}};return"uploadImage"in window&&(n.upload=uploadImage),n}(),Sound={_callbacks:[],_status:null,_loadstarted:!1,whenloaded:function(t){if(Sound._showdebug("wl"),Sound._status)try{t(Sound._status)}catch(t){}else Sound._showdebug("init"),Sound._callbacks.push(t),Sound._load_wrapper()},_docallbacks:function(){for(;Sound._callbacks.length>0;)Sound._docallback(Sound._callbacks.pop())},_docallback:function(t){try{t(Sound._status)}catch(t){Log.error("caught error in Sound.whenloaded callback: "+t)}},_showdebug:function(t){var e=document.getElementById("sounddebug");e&&(e.innerText=t)},_load_wrapper:function(){Sound._status={success:!0,subsystem:"wrapper",has_viz:"false"},Sound.SoundPlayer=WrapperSoundPlayer,Sound._docallbacks()}},WrapperSoundPlayer=function(){var t=this;t._html5player=null,t._html5formats=HTML5Player.supportedFormats(),t._currentplayer=null,t._handlers={state:[],time:[],loaded:[],info:[],volume:[]};var e=[];for(var i in t._html5formats)t._html5formats.hasOwnProperty(i)&&1==t._html5formats[i]&&e.push(i);function n(e){return function(){var i=arguments;"html5"==t._currentplayer&&t._html5player[e].apply(t._html5player,i)}}function a(e){return function(){var i=arguments;"html5"==t._currentplayer?t._html5player[e].apply(t._html5player,i):Log.error("WrapperSoundPlayer proxy for "+e+"(): no _soundplayer instance!")}}e.length>0&&(t._html5player=new HTML5Player,t._html5player.ontime((function(e,i){t._fire_event("time",i)})),t._html5player.onstate((function(e,i){t._fire_event("state",i)})),t._html5player.onloaded((function(e,i){t._fire_event("loaded",i)})),t._html5player.oninfo((function(e,i){t._fire_event("info",i)})),t._html5player.onvolume((function(e,i){t._fire_event("volume",i)})),t._currentplayer="html5"),t._add_event_handler=function(e,i){t._handlers[e].push(i)},t.onstate=function(e){t._add_event_handler("state",e)},t.ontime=function(e){t._add_event_handler("time",e)},t.onloaded=function(e){t._add_event_handler("loaded",e)},t.oninfo=function(e){t._add_event_handler("info",e)},t.onvolume=function(e){t._add_event_handler("volume",e)},t._fire_event=function(e,i){if(handlers=t._handlers[e],handlers)for(var n=0;n<handlers.length;n++)try{"html5"==t._currentplayer&&handlers[n](t._html5player,i)}catch(t){Log.debug('caught exception in handler for event "'+e+'": '+t)}},t.load=function(e,i){var n=null,a=null;if("string"==typeof e)a=e,n="mp3-128";else{var r=["aac-lo","mp3-128","opus-lo","vorbis-lo"];i&&r.unshift("mp3-v0");for(var s=0;s<r.length;s++)if(t._html5formats[r[s]]&&e[r[s]]){n=r[s];break}n||Log.error("no available HTML5-supported format"),a=e[n]}t._currentplayer="html5",t._html5player.load(a)};for(var r=["play","pause","stop","seek"],s={},o=0;o<r.length;o++)s[r[o]]=!0;for(var l in HTML5Player.prototype)"load"!=l&&"ontime"!=l&&"onstate"!=l&&"onloaded"!=l&&"oninfo"!=l&&"onvolume"!=l&&"function"==typeof HTML5Player.prototype[l]&&"_"!=l.substr(0,1)&&(s[l]?t[l]=n(l):t[l]=a(l))},LazySound=function(){var t=this;function e(e){return function(){var i=arguments;t.whenInstanceReady((function(t){t[e].apply(t,i)}))}}function i(e){return function(){var i=arguments;if(t._soundplayer)try{t._soundplayer[e].apply(t._soundplayer,i)}catch(i){t._loggedException||(t._loggedException=!0,Log.error("LazySound proxy for "+e+"(): caught exception: "+i))}else Log.error("LazySound proxy for "+e+"(): no _soundplayer instance!")}}t._soundplayer=null,t._loggedException=!1,t.whenInstanceReady=function(e){Sound.whenloaded((function(i){i.success?(t._soundplayer||(t._soundplayer=new Sound.SoundPlayer),e(t._soundplayer)):Log.error("LazySound: Sound.whenloaded failed: ",i)}))};for(var n=["play","pause","stop","load","onstate","ontime","onloaded","oninfo","onvolume","seek"],a={},r=0;r<n.length;r++)a[n[r]]=!0;for(var s in HTML5Player.prototype)"function"==typeof HTML5Player.prototype[s]&&"_"!=s.substr(0,1)&&(a[s]?t[s]=e(s):t[s]=i(s))},CommUtils={beacon:function(t,e){return this._loadImage(t,e,!0)},loadImage:function(t){return this._loadImage(t)},_loadImage:function(t,e,i,n){var a=document.createElement("img"),r=a;return a.style.display="none",a.onload=a.onerror=function(){try{a=null,n&&n()}catch(t){}},i&&!e.rand&&(e.rand=Math.random().toString().substring(2)),a.src=Url.addQueryParams(t,e),r},zzz:null},Cookie={ALT_IDENTITY_PARAM:"BandcampIdentity",get:function(t){$assert(Text.notEmpty(t));var e=Cookie.getAll()[t];return null==e&&(e=null),e},getAll:function(){for(var t,e,i,n=document.cookie.split(/;\s*/),a={},r=0;r<n.length;r++){var s=n[r].split("=");if(s[1]){var o,l;try{o=decodeURIComponent(s[0]),l=decodeURIComponent(s[1])}catch(t){Log.error("Cookie.getAll: error when decoding URL parameter, skipping; ",t);continue}e=l,i=void 0,(i=a[t=o])?U.isArray(i)?i.push(e):a[t]=[i,e]:a[t]=e}}return a},set:function(t,e,i,n,a,r){var s;$assert(Text.notEmpty(t)),$assert(null==i||U.isNumber(i)),null==e&&(e=""),n||(n="/"),a||(a=Cookie._secondLevelDomain()),null!=i&&(s=new Date((new Date).getTime()+1e3*i));var o=encodeURIComponent,l=o(t)+"="+o(e)+";path="+n+(null!=a?";domain="+a:"")+(s?";expires="+s.toUTCString():"")+(r?";secure":"");return document.cookie=l,l},clear:function(t,e,i,n){return Cookie.set(t,"",-1,e,i,n)},_secondLevelDomain:function(){var t=location.hostname.split("."),e=t.length;return $assert(e>=1),1==e?null:"."+t[e-2]+"."+t[e-1]}},HiddenParams={};if(function(){"use strict";HiddenParams.hide=function(t){Array.isArray(t)||(t=[t]),Log.debug("hiding params ["+t.join(", ")+"] from url query");var e={};t.forEach((function(t){e[t]=!0}));for(var i=Url.parseQueryArray(location.search),n=[],a=0;a<i.length;a++)e[i[a].name]||n.push(i[a]);var r=location.pathname.replace(/^\/+/,"/");n.length>0&&(r+="?"+Url.joinQueryArray(n)),r+=location.hash,BCTracker.afterPageView((function(){history.replaceState(null,document.title,r)}))},HiddenParams.get=function(t,e){if(!HiddenParams.hasOwnProperty(t)){void 0===e&&(e=!0);for(var i,n=Url.parseQueryArray(location.search),a=0;a<n.length;a++)if(n[a].name===t){i=n[a].value;break}HiddenParams[t]=i,e&&HiddenParams.hide(t)}return HiddenParams[t]};var t=document.currentScript.dataset.hideParams;if(t){var e=JSON.parse(t);e.push(".reload"),e.forEach((function(t){HiddenParams.get(t,!1)})),HiddenParams.hide(e)}}(),!window.Cookie)throw"expected Cookie library";Cookie.CommChannel=function(t,e){$assert(Text.notEmpty(t)),this._id=Math.round(1e9*Math.random()),e&&(t+=this._id),this._channelName=t;var i=Cookie.CommChannel.COOKIE_NAME_PREFIX+t;this._cookieName=i+"_"+this._id,this._namePattern=new RegExp("^"+Text.regexpEscape(i)+"_(\\d+)$"),this._queue={last:0,msgs:[]},this._lastSeen={},this._scanTimer=null,Cookie.clear(this._cookieName)},Cookie.CommChannel.EVENT_NAME="cookiecomm_message",Cookie.CommChannel.COOKIE_NAME_PREFIX="_comm_",Cookie.CommChannel.MAX_QUEUE_SIZE=5,Cookie.CommChannel.SCAN_TIMEOUT=250,Cookie.CommChannel.COOKIE_MAX_AGE=5,Cookie.CommChannel.prototype={getName:function(){return this._channelName},startListening:function(){if(!this._scanTimer){var t=this;this._scanTimer=setInterval((function(){t._scanAllQueues()}),Cookie.CommChannel.SCAN_TIMEOUT),Log.info("Cookie comm channel "+this.getName()+" started listening.")}},stopListening:function(){this._scanTimer&&(clearInterval(this._scanTimer),this._scanTimer=null,Log.info("Cookie comm channel "+this.getName()+" stopped listening."))},subscribe:function(t){$(document).on(Cookie.CommChannel.EVENT_NAME+"_"+this._id,t)},unsubscribe:function(t){$(document).off(Cookie.CommChannel.EVENT_NAME+"_"+this._id,t)},send:function(t){$assert(U.isString(t));var e=Iter.collect(arguments);Log.debug("Cookie comm channel "+this.getName()+" sending message "+e[0],e);for(var i=e.length-1;i>0&&null==e[i];i--)e.pop();var n=this._queue.msgs;n.push(e),this._queue.last++,n.length>Cookie.CommChannel.MAX_QUEUE_SIZE&&(this._queue.msgs=n.slice(1)),this._writeTimeout&&clearTimeout(this._writeTimeout);var a=this;this._writeTimeout=setTimeout((function(){a._writeQueue()}),0)},cleanup:function(){Cookie.clear(this._cookieName),this.stopListening(),this._lastSeen=this._queue=null},_writeQueue:function(){var t=JSON.stringify(this._queue);Cookie.set(this._cookieName,t,Cookie.CommChannel.COOKIE_MAX_AGE)},_scanAllQueues:function(){var t=Cookie.getAll();for(var e in t){var i=this._namePattern.exec(e);if(i){var n=i[1]-0;if(n!==this._id){var a=t[e];$assert(!U.isArray(a),"we expect only one cookie per name");var r=JSON.parse(a);this._scanOneQueue(n,r)}}}},_scanOneQueue:function(t,e){var i=e.last;$assert(U.isNumber(i));var n=i-(this._lastSeen[t]||0);if(n>0){var a=e.msgs.slice(-n);$assert(a.length),this._lastSeen[t]=i;for(var r=0;r<a.length;r++){var s=a[r];if(Log.debug("Cookie comm channel "+this.getName()+" received from "+t+" message "+s[0],s),s.unshift(t),$.event.trigger(Cookie.CommChannel.EVENT_NAME+"_"+this._id,[s]),!this._scanTimer)break}}}};var Stats=function(){"use strict";return{RECORD_URL:"/stat_record",hash_code:function(t){if(!t)return 0;for(var e=0,i=t.length,n=0;n<i;n++){e=(e<<5)-e+t.charCodeAt(n),e|=0}return e<0&&(e=4294967295+e+1),e.toString(16)},record_sendbeacon:function(t){if(!t.band_id&&window.BandData&&(t.band_id=BandData.id),t.uac=Stats.hash_code(navigator.userAgent),navigator.sendBeacon){t.rand="b"+Math.round(1e16*Math.random()).toString();var e=siteroot_current+Stats.RECORD_URL;e=Url.addQueryParams(e,t),navigator.sendBeacon(e)}else Stats.record(t)},record:function(t){var e=$("#pagedata").data(),i=e&&e.blob&&e.blob.disable_stats;if(i){if(!Array.isArray(i))return;if(i.includes(t.kind))return}!t.band_id&&window.BandData&&(t.band_id=BandData.id);try{CommUtils.beacon(siteroot_current+Stats.RECORD_URL,t)}catch(t){Log.warn("CommsUtil.beacon error")}},_recorded_clicks:{},record_click_once:function(t){Stats._recorded_clicks[t]||(Stats._recorded_clicks[t]=!0,Stats.record({kind:"click",click:t}))},share_menu_click:function(t){"wordpress"==t&&(t="wordpress.com"),Stats.record({kind:"share menu",click:t})}}}();Stats.PhasedStat=function(){"use strict";function t(t,e){this._params=t,this._params.phase=e,this._params.reference_num=Math.round(1e9*Math.random()),Stats.record(this._params)}return t.prototype={change_phase:function(t){this._params.phase=t,Stats.record(this._params)},done:function(){this.change_phase("complete")},error:function(t){this._params.info=t,this.change_phase("error")},add_params:function(t){this._params=this.merge(this._params,t)},merge:function(t,e){var i,n={};for(i in t)n[i]=t[i];for(i in e)n[i]=e[i];return n}},t}();var Identities=function(t){"use strict";var e=new function(e){var s=this;this.initialData=e,this.user=ko.observable(e.user),this.fan=ko.observable(e.fan),this.partner=ko.observable(e.partner),this.isAdmin=ko.observable(e.is_admin),this.ip_country_code=e.ip_country_code,this.pageBand=e.page_band&&new i(e.page_band),this.bmgr=new n(e.bands),this.lmgr=new r(e.labels),this.labels=this.lmgr.labels,this.labelIds=ko.computed((function(){return Iter.collect(s.labels(),(function(t){return t.id}))})),this.linkedNonLabelMemberBands=ko.computed((function(){return Iter.findAll(s.bmgr.bands(),(function(t){return!s.lmgr.isLabelMemberBand(t.id)}))})),this.linkedNonLabelBands=ko.computed((function(){return Iter.findAll(s.linkedNonLabelMemberBands(),(function(e){return-1===t.inArray(e.id,s.labelIds())}))})),this.hasLabels=ko.computed((function(){return s.labels().length>0})),this.pageBandParentLabel=ko.computed((function(){return Iter.find(s.labels(),(function(t){return t.id===e.page_band_parent_label_id}))}));var o=e.page_label&&new a(e.page_label);this.pageLabel=ko.computed((function(){return s.pageBandParentLabel()||s.pageBand&&s.labels()&&Iter.find(s.labels(),(function(t){return t.id===s.pageBand.id}))||o})),this.isPageBandMember=ko.observable(e.is_page_band_member),this.isPageBandNonLabelMember=ko.computed((function(){return s.pageBand&&Iter.find(s.bmgr.bands(),(function(t){return t.id==s.pageBand.id}))})),this.isParentLabel=ko.computed((function(){return!!s.pageBandParentLabel()})),this.hasFullAccess=ko.computed((function(){return s.isPageBandMember()||s.isAdmin()})),this.hasLimitedAccess=ko.computed((function(){return s.isParentLabel()&&e.page_band&&!e.page_band.authed})),this.isPageBand=function(t){return s.pageBand&&t===s.pageBand.id},this.isMemberOfBand=function(t){return s.bmgr.bandByID(t)||s.lmgr.isMemberBandAuthed(t)},this.activeLicenses=ko.observableArray(e.active_licenses),this.subscribedToPageBand=ko.observable(e.subscribed_to_page_band||!1),this.updateFromHash=function(t){t.bands&&s.bmgr.updateBands(Iter.collect(t.bands,(function(t){return new i(t)}))),t.page_band&&s.pageBand&&(t.page_band.name&&s.pageBand.name(t.page_band.name),t.page_band.photo&&s.pageBand.photo(t.page_band.photo),t.page_band.trackpipe_local_url&&s.pageBand.trackpipeLocalUrl(t.page_band.trackpipe_local_url)),s.isPageBandMember(t.is_page_band_member)},this.add=function(t){t.bands&&t.bands.length>0&&s.bmgr.addBands(t.bands),t.labels&&t.labels.length>0&&s.lmgr.addLabels(t.labels)},this.remove=function(t){t.bands&&t.bands.length>0&&s.bmgr.removeBands(t.bands),t.labels&&t.labels.length>0&&(s.lmgr.removeLabels(t.labels),s.bmgr.removeBands(t.labels))}}(U.pagedataBlob().identities||{});return e.BandVM=i,e.BandsMgr=n,window.ko&&window.ko.options.bindingGlobals&&(window.ko.options.bindingGlobals.Identities=e),e;function i(t){var e=this;this.id=t.id,this.name=ko.observable(t.name),this.photo=ko.observable(t.photo||t.bio&&t.bio.image_id),this.trackpipeUrl=ko.observable(t.trackpipe_url||t.url),this.trackpipeLocalUrl=ko.observable(t.trackpipe_local_url||t.url||t.trackpipe_url),this.trackpipeUrlHttps=ko.observable(t.trackpipe_url_https),this.dashboardUrl=ko.computed((function(){return e.trackpipeLocalUrl()+"/dashboard"})),this.isPro=ko.observable(t.is_pro),this.hasService=ko.observable(t.has_service),this.serviceName=ko.observable(t.service_name),this.serviceUrlFragment=ko.observable(t.service_url_fragment),this.isLabel=ko.observable(t.is_label),this.isLabelMemberBand=ko.observable(!1)}function n(t){var e,n=this;this.addBands=function(t){var n,a;n=Iter.collect(t,(function(t){return t instanceof i?t:new i(t)})),a=[Number.MAX_VALUE,0].concat(n),e.splice.apply(e,a)},this.bandByID=function(t){return Iter.find(e(),(function(e){return e.id===t}))},this.removeBands=function(t){var i=Iter.findAll(e(),(function(e){return!!Iter.find(t,(function(t){return t===e.id}))}));e.removeAll(i)},this.updateBandName=function(t,e){var i=n.bandByID(t);i&&i.name(e)},this.updateBands=function(t){e(t)},e=ko.observableArray(Iter.collect(t||[],(function(t){return new i(t)}))),this.bands=ko.computed((function(){var t=e.slice(0);return t.sort((function(t,e){return(t=t.name().toLowerCase())<(e=e.name().toLowerCase())?-1:t>e?1:0})),t})).extend({throttle:1}),this.anyPro=ko.computed((function(){return!!Iter.find(e(),(function(t){return t.isPro()}))}))}function a(t){var e=this;this.id=t.id,this.name=ko.observable(t.name),this.url=ko.observable(t.url),this.memberBands=ko.observableArray(Iter.collect(t.member_bands,(function(t){var e=new i(t);return e.isLabelMemberBand(!0),e.isAuthed=ko.observable(t.authed),e.hasItems=ko.observable(t.band_has_items),e}))),this.memberBandIds=ko.computed((function(){return Iter.collect(e.memberBands(),(function(t){return t.id}))}))}function r(t){var e=this;this.labels=ko.observableArray(Iter.collect(t||[],(function(t){return new a(t)})));var i=ko.computed((function(){var t={};return Iter.each(e.labels(),(function(e){Iter.each(e.memberBands(),(function(e){t[e.id]=t[e.id]||e.isAuthed()}))})),t}));this.isMemberBandAuthed=function(t){return i()[t]},this.isLabelMemberBand=function(t){return t in i()},this.labelByID=function(t){return Iter.find(e.labels(),(function(e){return e.id===t}))},this.addLabels=function(t){var i=Iter.collect(t,(function(t){return new a(t)})),n=[Number.MAX_VALUE,0].concat(i);e.labels.splice.apply(e.labels,n)},this.removeLabels=function(t){Iter.each(t,(function(t){var i=e.labelByID(t);e.labels.remove(i)}))}}}(jQuery),Color={isDark:function(t){var e=this.hex2rgb(t);return this.rgb2hsl(e)[2]<.5},lowContrast:function(t,e,i){var n,a;return void 0===i&&(i=3),this.luminance(e)>this.luminance(t)?(n=this.luminance(e),a=this.luminance(t)):(n=this.luminance(t),a=this.luminance(e)),ratio=(n+.05)/(a+.05),ratio<i},luminance:function(t){for(var e=this.hex2rgb(t),i=0;i<e.length;i++)e[i]<=.03928?e[i]=e[i]/12.92:e[i]=Math.pow((e[i]+.055)/1.055,2.4);return.2126*e[0]+.7152*e[1]+.0722*e[2]},rgb2hex:function(t){var e=Math.round(255*t[0]),i=Math.round(255*t[1]),n=Math.round(255*t[2]);return(e<16?"0":"")+e.toString(16)+(i<16?"0":"")+i.toString(16)+(n<16?"0":"")+n.toString(16)},hex2rgb:function(t){return 6==(t=t.replace(/^#/,"")).length?[parseInt("0x"+t.substring(0,2))/255,parseInt("0x"+t.substring(2,4))/255,parseInt("0x"+t.substring(4,6))/255]:3==t.length?[parseInt("0x"+t.substring(0,1))/15,parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15]:void 0},hsl2rgb:function(t){var e,i,n=t[0],a=t[1],r=t[2],s=function(t,e,i){return 6*(i=i<0?i+1:i>1?i-1:i)<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(.66666-i)*6:t};return[s(e=2*r-(i=r<=.5?r*(a+1):r+a-r*a),i,n+.33333),s(e,i,n),s(e,i,n-.33333)]},rgb2hsl:function(t){var e,i,n,a,r,s,o=t[0],l=t[1],u=t[2];return e=Math.min(o,Math.min(l,u)),n=(i=Math.max(o,Math.max(l,u)))-e,r=0,(s=(e+i)/2)>0&&s<1&&(r=n/(s<.5?2*s:2-2*s)),a=0,n>0&&(i==o&&i!=l&&(a+=(l-u)/n),i==l&&i!=u&&(a+=2+(u-o)/n),i==u&&i!=o&&(a+=4+(o-l)/n),a/=6),[a,r,s]}},Share={showFromEmbed:function(){Share.panelAsDialog()},openFacebookShare:function(t,e){var i="http://www.facebook.com/sharer.php?u="+encodeURIComponent(t);return i+="&p[title]=ptitle&p[summary]=psummary",e&&(i+="&t="+encodeURIComponent(e)),window.open(i,"sharer","toolbar=0,status=0,width=626,height=436"),!1},openTwitterShare:function(t,e){var i={};return i.text=t,e&&(i.url=e),window.open(Url.addQueryParams("https://twitter.com/intent/tweet",i)),!1},panelLinkPromise:new $.Deferred,_panelInited:!1,_panelData:null,initPanel:function(t,e,i){if("phone"!=MediaView.mode&&!$(".share-embed").length){var n;$("#band-links a").each((function(){var t=/twitter\.com\/(?:#!)?(\w+)/i.exec($(this).attr("href"));if(t)return n=t[1],!1})),Share._panelData={linkback:i,is_track:t,enable_social_buttons:e,title:TralbumData.current.title,artist:TralbumData.artist,twitter_username:n,download_pref:TralbumData.current.download_pref,embed_info:EmbedData.embed_info};var a={embed_info:$("#pagedata").data("blob").embed_info};$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_collect_controls",a)),$(".share-embed").click((function(){Share.togglePanel()})),$(".exclusive-embed").click((function(){EmbedDialog.open("exclusive")})),e&&Share.initSocialButtons(),Share.panelLinkPromise.resolve()}},initSocialButtons:function(){FacebookUtils.initSDK()},panelAsDialog:function(){Share.panelLinkPromise.then(Share._panelAsDialog)},_panelAsDialog:function(){var t=Share._panelData,e=$(Templ.render("tralbum_common/share_embed_panel",t)).dialog({draggable:!0,position:"center",modal:!0,title:"Share",width:380,height:260});e.find(".email-im-link-text").blur(),Share._initPanelControls(e,t,(function(){e.dialog("close")})),Share._panelData.enable_social_buttons&&SocialControls.initFromDOM(e)},_initPanelControls:function(t,e,i){var n=$(t);n.find(".close").click((function(){i()})),n.find(".embed-other-services a").click((function(){Stats.record({kind:"click",click:"embed_other"}),EmbedDialog.open(),i()})),n.find(".embed-other-services-exclusive a").click((function(){Stats.record({kind:"click",click:"embed_other_exclusive"}),EmbedDialog.open("exclusive"),i()})),n.find(".share-buttons").on("click",".twitter-link, .tumblr-link",(function(){i()})),n.find(".email-im-link input").focus((function(){EmailIMUtils.onFocus()})).click((function(){$(this).select()}))},togglePanel:function(){var t=null;if(Share._panelInited)t=Share._panelRoot;else{var e=Share._panelData;t=$(".share-panel-wrapper-desktop").append(Templ.render("tralbum_common/share_embed_panel",e));Share._initPanelControls(t,e,(function(){Share.togglePanel()})),Share._panelRoot=t}var i=t.find(".share-embed-container"),n="none"==i.css("display");i.slideToggle("fast",(function(){n&&Dom.scrollToElement(i,20,!0)})),Share._panelInited||(Share._panelData.enable_social_buttons&&SocialControls.initFromDOM(t),Share._panelInited=!0)},xxx:null},Dom={getText:function(t){return(t=elt(t))?t.textContent:""},setText:function(t,e){(t=elt(t))&&(t.textContent=e)},getValue:function(t){switch((t=elt(t)).type){case"checkbox":return t.checked?t.value:null;case"radio":for(var e=document.getElementsByName(t.name),i=0,n=e.length;i<n;i++)if(e[i].checked)return e[i].value;return null}return t.value},setUnselectable:function(t){(t=elt(t))&&(t.style.userSelect="none")},focus:function(t){t=elt(t);try{t.focus()}catch(t){}},select:function(t,e){t=elt(t);try{t.select(),e&&t.focus()}catch(t){}},getDocumentHeight:function(){return document.documentElement["gecko"==Browser.type?"offsetHeight":"scrollHeight"]},wrapElem:function(t,e){return U.isString(e)&&(e=document.createElement(e)),$(e).insertBefore(t).append(t),e},scrollToElement:function(t,e,i){if(t.charAt&&"#"!=t.charAt(0)&&(t="#"+t),(t=$(t)).length){t.parents().each((function(t,e){e.style&&"none"==e.style.display&&(e.style.display="")}));var n=document.scrollingElement;if(n||(n=document.documentElement&&null!=document.documentElement.scrollTop?document.documentElement:document.body),null==e&&(e=-10),i){var a=document.documentElement.clientHeight,r=t.height(),s=n.scrollTop,o=n.scrollTop+a,l=t.offset().top,u=t.offset().top+r;if(l>=s){if(u<o)return;e+=u-a}else e+=l}else e+=t.offset().top;$(n).animate({scrollTop:e},500)}},hideEverythingStack:[],hideEverythingThanksAndroid:function(){if("androidbrowser"==Browser.make){var t=Array.prototype.slice.call(arguments);if(0==t.length)return;var e=$(".logView")[0];e&&t.push(e),$(this.hideEverythingStack[0]).css("visibility","inherit"),$(t).css("visibility","visible"),$(t).each((function(t,e){})),this.hideEverythingStack.unshift(t),$(document.body).css("visibility","hidden")}},unhideEverythingThanksAndroid:function(){if("androidbrowser"==Browser.make){var t=Array.prototype.slice.call(arguments),e=this.hideEverythingStack[0],i=!1;if(e&&e.length>0&&$(t).each((function(t,n){$(e).each((function(t,e){i=i||n==e}))})),!i)return void Log.error("Elt not found unhiding for android fixup");this.hideEverythingStack.shift(),elems=this.hideEverythingStack[0]||document.body,$(elems).css("visibility","visible"),$(elems).each((function(t,e){}))}},hackLinkClicksThanksSafari:function(t,e){t=$(t),"iphone"==Browser.platform?t.on({touchend:function(t){var e=this.getAttribute("href");e&&"#"!=e.substring(0,1)&&this.setAttribute("href","#"+e)},click:function(t){var i=this.getAttribute("href");if(i&&"#"==i.substring(0,1)&&this.setAttribute("href",i.substring(1)),e)return e.apply(this,arguments)}}):e&&t.on("click",e)},inViewport:function(t){for(var e=t.offsetTop,i=t.offsetLeft,n=t.offsetWidth,a=t.offsetHeight;t.offsetParent;)e+=(t=t.offsetParent).offsetTop,i+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&e+a>window.pageYOffset&&i+n>window.pageXOffset},getCursorPosition:function(t){var e,i=0;return document.selection?(t.focus(),(e=document.selection.createRange()).moveStart("character",-t.value.length),i=e.text.length):void 0!==t.selectionStart&&(i=t.selectionStart),i},setCursorPosition:function(t,e){var i;t.setSelectionRange?(t.focus(),t.setSelectionRange(e,e)):t.createTextRange&&((i=t.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select())},getXY:function(t){if("none"==window.getComputedStyle(t).display)return!1;var e=t.ownerDocument,i=e.documentElement,n=e.body,a=Math.max(i.scrollLeft,n.scrollLeft),r=Math.max(i.scrollTop,n.scrollTop),s=t.getBoundingClientRect();return xy=new Array(2),xy[0]=Math.round(s.left+a),xy[1]=Math.round(s.top+r),xy},xxx:null},Time={useIntl:"undefined"!=typeof Intl&&void 0!==Intl.DateTimeFormat,timeFormats:{en:{yyyyMd:{form:"%-m/%-d/%Y"},yyyyMMdd:{form:"%m/%d/%Y"},yyyyMMM:{form:"%b %Y"},yyyyMMMM:{form:"%B %Y"},yyyyMMMd:{form:"%b %-d, %Y"},yyyyMMMMd:{form:"%B %-d, %Y"},yyyyMMMdhmm:{form:"%b %-d, %Y %-I:%M %p"},yyyyMMMMdhmm:{form:"%B %-d, %Y %-I:%M %p"},yyyyMMMMdhmmzz:{form:"%B %-d, %Y at %-I:%M %p %Z"},yyyyMMMMdEEEEhmmzz:{form:"%A, %B %-d, %Y at %-I:%M %p %Z"},MMMMd:{form:"%B %-d"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M %p %Z"},hhmm:{form:"%l:%M %p"}},fr:{yyyyMd:{form:"%d/%m/%Y"},yyyyMMdd:{form:"%d/%m/%Y"},yyyyMMM:{form:"%b %Y",localize:["month_short"]},yyyyMMMM:{form:"%B %Y",localize:["month"]},yyyyMMMd:{form:"%-d %b %Y",localize:["month_short"]},yyyyMMMMd:{form:"%-d %B %Y",localize:["month"]},yyyyMMMdhmm:{form:"%-d %b %Y à %H:%M",localize:["month_short"]},yyyyMMMMdhmm:{form:"%-d %B %Y à %H:%M",localize:["month"]},yyyyMMMMdhmmzz:{form:"%-d %B %Y à %H:%M %Z",localize:["month"]},yyyyMMMMdEEEEhmmzz:{form:"%A %-d %B %Y à %H:%M %Z",localize:["month","weekday"]},MMMMd:{form:"%-d %B",localize:["month"]},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M %Z"},hhmm:{form:"%H:%M"}},ja:{yyyyMd:{form:"%Y/%-m/%-d"},yyyyMMdd:{form:"%Y/%m/%d"},yyyyMMM:{form:"%Y年%-m月"},yyyyMMMM:{form:"%Y年%-m月"},yyyyMMMd:{form:"%Y年%-m月%-d日"},yyyyMMMMd:{form:"%Y年%-m月%-d日"},yyyyMMMdhmm:{form:"%Y年%-m月%-d日 %H:%M"},yyyyMMMMdhmm:{form:"%Y年%-m月%-d日 %H:%M"},yyyyMMMMdhmmzz:{form:"%Y年%-m月%-d日 %H:%M %Z"},yyyyMMMMdEEEEhmmzz:{form:"%Y年%-m月%-d日 (%A) %H:%M %Z",localize:["weekday"]},MMMMd:{form:"%-m月%-d日"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%H:%M %Z"},hhmm:{form:"%H:%M"}}},localizedTimeValues:{fr:{month_short:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],month:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],weekday:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ja:{weekday:["日","月","火","水","木","金","土"]}},get_locale:function(t){return void 0!==t&&""!=t||(t="Translate"in window?Translate.locale:"en"),"qq"==t&&(t="ja"),t},get_local_timezone:function(){return Time.useIntl?new Intl.DateTimeFormat("en").resolvedOptions().timeZone:null},shiftDate:function(t,e,i){if(!Time.useIntl)return{date:t,tzname:"UTC"};for(var n,a,r,s,o,l,u,c=e+"-u-hc-h23",h=new Intl.DateTimeFormat(c,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1,timeZoneName:"short",timeZone:i}).formatToParts(t),d=0;d<h.length;d++)switch(h[d].type){case"year":n=parseInt(h[d].value);break;case"month":a=parseInt(h[d].value)-1;break;case"day":r=parseInt(h[d].value);break;case"hour":s=parseInt(h[d].value);break;case"minute":o=parseInt(h[d].value);break;case"second":l=parseInt(h[d].value);break;case"timeZoneName":u=h[d].value}return{date:new Date(Date.UTC(n,a,r,s,o,l)),tzname:u}},to_ui:function(t,e,i,n,a){var r;void 0===e&&(e=1),"string"==typeof t&&(t=new Date(t)),i=Time.get_locale(i),"function"==typeof t.getUTCFullYear&&(void 0===a&&(a=!0),r=new Date(t),a?(r.year=t.getUTCFullYear(),r.month=t.getUTCMonth()+1,r.mday=t.getUTCDate(),r.hour=t.getUTCHours(),r.min=t.getUTCMinutes(),r.sec=t.getUTCSeconds(),r.tz="UTC"):(r.year=t.getFullYear(),r.month=t.getMonth()+1,r.mday=t.getDate(),r.hour=t.getHours(),r.min=t.getMinutes(),r.sec=t.getSeconds(),r.tz=t.toTimeString().match(/\((.*)\)/)[1]),t=r);var s="<d'oh bad to_ui format>";if("number"==typeof e)switch(e){case 1:c=Time.to_ui(t,2)+" "+Time.to_ui(t,3);break;case 2:c=t.month+"/"+t.mday+"/"+t.year%100;break;case 3:var o;0==(o=t.hour>12?t.hour-12:t.hour)&&(o=12),c=o+":"+(t.min<10?"0"+t.min:""+t.min)+(t.hour>=12?"pm":"am");break;case 4:c=t.month+"/"+t.mday+"/"+t.year;break;case 5:c=Time.to_ui(t,4)+" "+Time.to_ui(t,3);break;case 6:c=Time.tables.B[t.month-1]+" "+t.mday+", "+t.year;break;case 7:c=Time.to_ui(t,6)+" "+Time.to_ui(t,3);break;case 8:c=Time.to_ui(t,7)+" "+t.tz;break;case 9:c=Time.strftime(t,"%Y-%m-%d");break;case 10:c=Time.strftime(t,"%d %B %Y %H:%M:%S");break;case 11:c=Time.tables.b[t.month-1]+" "+t.mday+", "+t.year;break;case 12:c=Time.strftime(t,"%Y-%m-%d %H:%M:%S");break;case 13:c=Time.strftime(t,"%B %Y");break;case 14:c=Time.strftime(t,"%m/%d/%Y");break;default:c=s}else if("string"==typeof e){var l=Time.timeFormats[i][e],u=l.form;if(void 0!==n){var c=Time.shiftDate(t,i,n);t=c.date,u=u.replace(/%(Z)/g,c.tzname)}if("localize"in l){var h=l.localize,d=Time.localizedTimeValues[i];h.forEach((function(e){var i=d[e];switch(e){case"month_short":u=u.replace(/%b/g,i[t.getMonth()]);break;case"month":u=u.replace(/%B/g,i[t.getMonth()]);break;case"weekday":u=u.replace(/%A/g,i[t.getDay()]);break;default:u=s}}))}c=Time.strftime(t,u)}else c=s;return c},toUi:function(t,e,i,n){U.isString(t)&&(t=new Date(t));var a=t[i?"getUTCHours":"getHours"](),r=t[i?"getUTCMinutes":"getMinutes"]();if(r=r<10?"0"+r:r,n){a=a<10?"0"+a:a;var s=""}else{var o=a>12?a-12:a;0==o&&(o=12);s=a>=12?"pm":"am";a=o}return Time.toUiDate(t,e,i)+" "+a+":"+r+s},toUiDate:function(t,e,i){U.isString(t)&&(t=new Date(t));var n=t[i?"getUTCFullYear":"getFullYear"]().toString();return e||(n=n.substr(2)),t[i?"getUTCMonth":"getMonth"]()+1+"/"+t[i?"getUTCDate":"getDate"]()+"/"+n},relativeTimeFormats:{en:{today:"today",yesterday:"yesterday",days_ago:"{{days_ago}} days ago",one_hour_ago:"1 hour ago",hours_ago:"{{hours_ago}} hours ago",one_minute_ago:"1 minute ago",minutes_ago:"{{minutes_ago}} minutes ago",seconds_ago:"{{seconds_ago}} seconds ago",just_now:"just now"},fr:{today:"aujourd'hui",yesterday:"hier",days_ago:"il y a {{days_ago}} jours",one_hour_ago:"il y a 1 heure",hours_ago:"il y a {{hours_ago}} heures",one_minute_ago:"il y a 1 minute",minutes_ago:"il y a {{minutes_ago}} minutes",seconds_ago:"il y a {{seconds_ago}} secondes",just_now:"à l'instant"},ja:{today:"今日",yesterday:"昨日",days_ago:"{{days_ago}}日前",one_hour_ago:"1時間前",hours_ago:"{{hours_ago}}時間前",one_minute_ago:"1分前",minutes_ago:"{{minutes_ago}}分前",seconds_ago:"{{seconds_ago}}秒前",just_now:"ちょうど今"}},timeStr:function(t){var e="";for(t=Math.floor(t);t>0;){var i=t%60,n=i.toString();n.length<2&&(n="0"+n),e=e.length>0?n+":"+e:n,t-=i,t/=60}return 0==e.length?e="00:00":e.length<3&&(e="00:"+e),e},calc_days_ago:function(t){return Math.floor((new Date-t)/864e5)},relative_day:function(t,e,i){U.isString(t)&&(t=new Date(t)),i=Time.get_locale(i);var n=Time.relativeTimeFormats[i],a=Time.calc_days_ago(t);if(0==a)return n.today;if(1==a)return n.yesterday;if(e)return Time.to_ui(t,e,i);var r=n.days_ago,s={days_ago:a};return r.replace(/\{\{(.*?)\}\}/g,(function(t,e){return s[e]}))},relative_time:function(t,e,i){U.isString(t)&&(t=new Date(t)),i=Time.get_locale(i);var n=Time.relativeTimeFormats[i];if(0!=Time.calc_days_ago(t))return Time.relative_day(t,e,i);var a=(new Date-t)/1e3,r=a/60,s=r/60;a=Math.floor(a),r=Math.floor(r),s=Math.floor(s);var o,l={};if(s>4)return n.today;if(s>1)l.hours_ago=s,o=n.hours_ago;else{if(s>0)return n.one_hour_ago;if(r>1)l.minutes_ago=r,o=n.minutes_ago;else{if(r>0)return n.one_minute_ago;if(!(a>15))return n.just_now;l.seconds_ago=a,o=n.seconds_ago}}return o.replace(/\{\{(.*?)\}\}/g,(function(t,e){return l[e]}))},relativeDurationFormats:{en:{days:"{{days}} days",day:"1 day",hours:"{{hours}} hours",hour:"1 hour",minutes:"{{minutes}} minutes",minute:"1 minute",less_than_a_minute:"under a minute"},fr:{days:"{{days}} jours",day:"Un jour",hours:"{{hours}} heures",hour:"1 heure",minutes:"{{minutes}} minutes",minute:"1 minute",less_than_a_minute:"sous une minute"},ja:{days:"{{days}}日",day:"1日",hours:"{{hours}}時間",hour:"1時間",minutes:"{{minutes}}分",minute:"1分",less_than_a_minute:"数秒"}},relative_duration:function(t,e,i){i=Time.get_locale(i),void 0===e&&(e=!1);var n=Time.relativeDurationFormats[i],a=t/60,r=t/3600,s=t<86400?0:t/86400;a=Math.floor(a),r=Math.floor(r),s=Math.round(s);var o,l={};if(e){if(s>=1)return Time.relative_duration(t,!1,i);if(r<1||a%60==0)return Time.relative_duration(t,!1,i);var u=Time.relative_duration(3600*r,!1,i),c=Time.relative_duration(a%60*60,!1,i);return"ja"==i?u+c:u+", "+c}if(s>1)l.days=s,o=n.days;else{if(1==s)return n.day;if(r>1)l.hours=r,o=n.hours;else{if(1==r)return n.hour;if(!(a>1))return 1==a?n.minute:n.less_than_a_minute;l.minutes=a,o=n.minutes}}return o.replace(/\{\{(.*?)\}\}/g,(function(t,e){return l[e]}))},toUpcomingDate:function(t,e){return U.isString(t)&&(t=new Date(t)),Time.getMonthName(t[e?"getUTCMonth":"getMonth"]())+" "+t[e?"getUTCDate":"getDate"]()},getMonthName:function(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]},strToDate:function(t){if(!t)return null;~(t=t.replace(/-/g,"/")).indexOf("UTC")||~t.indexOf("GMT")||(t+=" UTC");var e=new Date(t),i=isNaN(new Date("3/7"));if(isNaN(e)||!i){var n=new Date;n.setMonth(n.getMonth()-3);for(var a=(new Date).getFullYear()-1,r=a;r<a+3;r++){var s=new Date(t+" "+r);if(s>n){e=s;break}}if(isNaN(e))return null}else{var o=e.getFullYear();if(o<2e3&&-1==t.indexOf(o)){var l=o.toString().substr(2,2);parseInt(l)<=parseInt(((new Date).getFullYear()+25).toString().substr(2,2))&&e.setFullYear(o+100)}}return e},tables:{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],p:["AM","PM"],P:["A","P"]},formats:{a:function(t){return Time.tables.a[t.getUTCDay()]},A:function(t){return Time.tables.A[t.getUTCDay()]},b:function(t){return Time.tables.b[t.getUTCMonth()]},B:function(t){return Time.tables.B[t.getUTCMonth()]},"-d":function(t){return t.getUTCDate()},d:function(t){return TextFormat.pad(t.getUTCDate(),"0",10)},e:function(t){return TextFormat.pad(t.getUTCDate()," ",10)},H:function(t){return TextFormat.pad(t.getUTCHours(),"0",10)},"-I":function(t){var e=t.getUTCHours()%12;return 0===e?12:e},I:function(t){var e=t.getUTCHours()%12;return TextFormat.pad(0===e?12:e,"0",10)},l:function(t){var e=t.getUTCHours()%12;return 0===e?12:e},j:function(t){var e=t-new Date(t.getUTCFullYear()+"/1/1 GMT"),i=parseInt(e/6e4/60/24,10)+1;return TextFormat.pad(i,"0",100)},"-m":function(t){return t.getUTCMonth()+1},m:function(t){return TextFormat.pad(t.getUTCMonth()+1,"0",10)},M:function(t){return TextFormat.pad(t.getUTCMinutes(),"0",10)},p:function(t){return Time.tables.p[t.getUTCHours()>=12?1:0]},P:function(t){return Time.tables.P[t.getUTCHours()>=12?1:0]},s:function(t){return parseInt(t.getTime()/1e3)},S:function(t){return TextFormat.pad(t.getUTCSeconds(),"0",10)},u:function(t){var e=t.getUTCDay();return 0===e?7:e},U:function(t){var e=parseInt(Time.formats.j(t),10),i=6-t.getUTCDay(),n=parseInt((e+i)/7,10);return TextFormat.pad(n,"0",10)},w:function(t){return t.getUTCDay().toString()},W:function(t){var e=parseInt(Time.formats.j(t),10),i=7-Time.formats.u(t),n=parseInt((e+i)/7,10);return TextFormat.pad(n,"0",10)},y:function(t){return TextFormat.pad(t.getUTCFullYear()%100,"0",10)},Y:function(t){return t.getUTCFullYear().toString()},Z:function(t){return"UTC"},"%":function(t){return"%"}},aggregates:{c:"%a %b %e %X %Y",x:"%m/%d/%y",X:"%H:%M:%S"},strftime:function(t,e){for(;e.match(/%[cDhnrRtTxX]/);)e=e.replace(/%([cDhnrRtTxX])/g,(function(t,e){return Time.aggregates[e]}));return(e=e.replace(/%(\-[dmI])/g,(function(e,i){return Time.formats[i](t)}))).replace(/%([aAbBCdegGHIjlmMpPsSuUVwWyYzZ%])/g,(function(e,i){return Time.formats[i](t)}))}},TextFormat={currency:function(t,e,i,n,a){t.is_money&&(window.CurrencyData||Log.server("Missing CurrencyData for TextFormat.currency on "+window.location.pathname,"error"),e=window.CurrencyData.info[t.currency],t=t.amount/100);var r=e||{prefix:"$",symbol:"USD",places:2},s=t>=1||0==t?r.places:2;n&&t>=1&&Math.round(t)==t&&(s=0);var o=t.toFixed(s);return i?o:(o=TextFormat.commafyNumber(o),r.symbol&&!a&&(o+=" "+r.symbol),r.prefix_utf8+o)},money:function(t,e,i){"use strict";window.CurrencyData||Log.server("Missing CurrencyData for TextFormat.money on "+window.location.pathname,"error"),t&&t.is_money&&("number"==typeof e&&(i=e),e=t.currency,t=t.amount/100),t=t||0,e=e||"USD",i=i||1;var n=CurrencyData.info[e],a=n.places;t===Math.round(t)?2!==i&&7!==i&&9!==i||(a=0):0===a&&(a=2);var r=t.toFixed(a);return 5!==i&&8!==i&&9!==i&&(r=this.commafyNumber(r)),4===i&&"-"===r[0]&&(r="("+r.substr(1)+")"),1===i||2===i?r=n.prefix_utf8+r:6!==i&&7!==i||(r=n.prefix_utf8+" "+r),5===i&&(r=Array(8-r.length).join(" ")+r),r},million_usd:function(t,e){"use strict";var i="";switch(e){case"ja":i=t>=100?(t/100).toFixed(1)+"億ドル":(100*t).toFixed(0)+"万ドル";break;case"fr":i=(i=t>=100?t.toFixed(0)+" millions de dollars":t.toFixed(1)+" millions de dollars").replace(".",",");break;default:i=t>=100?"$"+t.toFixed(0)+" million":"$"+t.toFixed(1)+" million"}return i},toMb:function(t,e){var i=e?1e3:1024,n=1,a=i,r=Iter.find([" bytes","K","MB","GB","TB","PB"],(function(){return t<a||(n=a,a*=i,!1)}));if(!r)return t.toString();var s=Math.round(t/n*10);return s%10==0?s/10+r:(s/10).toFixed(1)+r},pad:function(t,e,i){for(t=t.toString();parseInt(t,10)<i&&i>1;i/=10)t=e+t;return t},_determine_locale_separators:function(){1.2.toFixed(1).indexOf(".")>=0?TextFormat._separators={decimal:".",thousands:","}:TextFormat._separators={decimal:",",thousands:"."}},commafyNumber:function(t){TextFormat._separators||TextFormat._determine_locale_separators();var e=t.split(TextFormat._separators.decimal),i=e[0],n=e[1]?TextFormat._separators.decimal+e[1]:"",a=!1;if(0==i&&!n)return"0";"-"===i.substr(0,1)&&(i=i.substr(1),a=!0);for(var r=i.length,s="",o=0;(r-o)%3>0;)s+=i.substr(o,1),o++;for(s.length>0&&r-o>0&&(s+=TextFormat._separators.thousands);r-o>3;)s+=i.substr(o,3)+TextFormat._separators.thousands,o+=3;return r-o>0&&(s+=i.substr(o)),(a?"-":"")+s+n},noOrphan:function(t){return t.replace(/([^ ]+) +([^ ]+)$/,"$1 $2")}};function addExpandEventListeners(t,e){$(t).off(".bcExpand").on("paste.bcExpand keyup.bcExpand focus.bcExpand",(function(t){updateFieldHeight(t,e)}))}function updateFieldHeight(t,e){var i=t.target,n=250,a=parseInt(i.clientHeight),r=parseInt(i.scrollHeight);e?(i.style.height="auto",i.style.height=r>n?"250px":i.scrollHeight+"px"):r>a&&(r>n&&(r=n),i.style.height=r+"px")}function addShrinkEventListeners(t,e){$(t).blur((function(t){shrinkFieldHeight(t,e)}))}function shrinkFieldHeight(t,e){var i=t.target;parseInt(i.scrollHeight)>e&&(i.style.height=e+"px")}function addCharacterCountdownEventListeners(t,e,i){function n(n){var a=i-$(t).val().length;$(e).toggleClass("notable",a<=0),a<0&&n&&($(t).val($(t).val().substr(0,i)),a=0),$(e).find(".counter").text(""+a)}$(t).on("input",(function(){n(!0)})),(!("oninput"in t)||"ie"===Browser.make&&Browser.version[0]<=9)&&$(t).on("paste cut keyup",(function(){setTimeout(n,0,!0)})),n(!1)}function InterruptibleTimer(){this._timer=null}InterruptibleTimer.prototype={start:function(t,e){this.stop(),this._timer=setTimeout(t,e)},stop:function(){clearTimeout(this._timer)}};var WatchInput={watchInput:function(t,e,i){$assert("string"==typeof t),null==this.__watching&&(this.__watching={});var n=this.__watching[t]={};n.__watchInput_elt=t,n.__watchInput_default=e,n.__watchInput_type=i||"float";var a=this;setTimeout((function(){a.__watchInput(t)}),500)},__watchInput:function(t){var e=this.__watching[t];if(e){var i,n=elt(e.__watchInput_elt);if(n){var a=null==n.value?n.innerHTML:n.value;switch(e.__watchInput_type){case"float":var r=parseFloat(a);isNaN(r)&&(r=e.__watchInput_default);break;case"integer":r=parseInt(a);isNaN(r)&&(r=e.__watchInput_default);break;default:r=a}if(r!=e.__watchInput_Last&&this.inputChanged)try{this.inputChanged(r,e.__watchInput_elt)}catch(i){Log.error(i)}e.__watchInput_Last=r;var s=this;setTimeout((function(){s.__watchInput(t)}),500)}else this.__watching[t]=null}}},Expression={eval:function(t,e,i){var n=this.init(t,e,i),a=this.parse_top(n);if("end"!=this.next_token(n).kind)throw"Expression error: '"+n.expr+"' -- end expected";return a},dump:function(t,e,i){for(var n=this.init(t,e,i);;){var a=this.next_token(n);if(console.log(a.kind+" "+a.value),"end"==a.kind)break}},init:function(t,e,i){var n={};return n.expr=t,n.handle_constants=i,n.eval_lambda=e,n.return_prev_token=!1,n.short_circuit=!1,n},OPERATORS:["||","&&","<=","==","!=",">=","<",">","+","-","*","/","%","!","(",")"],next_token:function(t){if(t.return_prev_token)return t.return_prev_token=!1,t.previous_token;var e={};if(t.expr=t.expr.replace(/^\s+/,""),""==t.expr)e.kind="end";else{for(var i=0;i<this.OPERATORS.length;++i){var n=this.OPERATORS[i];if(t.expr.substr(0,n.length)==n){e.kind=n,t.expr=t.expr.slice(n.length);break}}var a;if(!e.kind)(a=t.expr.match(/^(\'[^\']*\')/)||t.expr.match(/^(\"[^\"]*\")/)||t.expr.match(/([^\s\+\-\*\/\%\(\)\<\=\>\!\&\|\'\"]+)/))&&(e.value=a[1],e.kind="term",t.expr=t.expr.slice(e.value.length))}return t.previous_token=e,e},backup:function(t){t.return_prev_token=!0},is_true:function(t){return!1!==t&&null!=t},parse_top:function(t){return this.parse_boolean_op(t)},parse_boolean_op:function(t){for(var e=this.parse_comparison_op(t);;)switch(this.next_token(t).kind){case"||":if(this.is_true(e)){var i=t.short_circuit;t.short_circuit=!0,this.parse_boolean_op(t),t.short_circuit=i}else e=this.parse_comparison_op(t);break;case"&&":if(this.is_true(e))e=this.parse_comparison_op(t);else{i=t.short_circuit;t.short_circuit=!0,this.parse_boolean_op(t),t.short_circuit=i}break;default:return this.backup(t),e}},parse_comparison_op:function(t){for(var e,i=this.parse_additive_op(t);;)switch(e=this.next_token(t).kind){case"<":case"<=":case"==":case"!=":case">=":case">":i=this.evaluate_comparison(e,i,this.parse_additive_op(t));break;default:return this.backup(t),i}},evaluate_comparison:function(t,e,i){if("=="===t)return e&&e.is_money?i&&i.is_money&&e.currency===i.currency&&e.amount===i.amount:e==i;if("!="===t)return!this.evaluate_comparison("==",e,i);if(void 0!==e&&void 0!==i||Log.error("Expression: inequality comparison with an undefined operand will always return false"),e&&e.is_money){if(!i||!i.is_money)throw"money cannot be compared with non-money";if(e.currency!==i.currency)throw"money comparison currency mismatch";e=e.amount,i=i.amount}switch(t){case"<":return e<i;case">":return e>i;case"<=":return e<=i;case">=":return e>=i;default:throw"invalid comparison operator: "+t}},parse_additive_op:function(t){for(var e=this.parse_multiplicative_op(t);;)switch(this.next_token(t).kind){case"+":e+=this.parse_multiplicative_op(t);break;case"-":e-=this.parse_multiplicative_op(t);break;default:return this.backup(t),e}},parse_multiplicative_op:function(t){for(var e=this.parse_term(t);;)switch(this.next_token(t).kind){case"*":e*=this.parse_term(t);break;case"/":e/=this.parse_term(t);break;case"%":e%=this.parse_term(t);break;default:return this.backup(t),e}},parse_term:function(t){var e,i=this.next_token(t);switch(i.kind){case"(":if(e=this.parse_top(t),")"!=this.next_token(t).kind)throw"Expression error: '"+t.expr+"' -- unbalanced parentheses";break;case"+":e=this.parse_term(t);break;case"-":e=-this.parse_term(t);break;case"!":e=!this.is_true(this.parse_term(t));break;case"term":if(!t.short_circuit){var n=t.handle_constants;if(n&&(n=this.constant(i.value))&&(e=n.v),!n){if(!t.eval_lambda)throw"Expression error: '"+t.expr+"' -- not a term";e=t.eval_lambda(i.value)}}}return t.short_circuit?1:e},constant:function(t){var e;return t.match(/^\d/)?t.match(/e|E|\./)?{v:parseFloat(t)}:{v:parseInt(t)}:(e=t.match(/^\'(.*)\'$/)||t.match(/^\"(.*)\"$/))?{v:e[1]}:"true"==t?{v:!0}:"false"==t?{v:!1}:"nil"==t?{v:null}:null}},StatusSpinny={spinnyID:"status-spinny",spinningClass:"spinning",timeouts:[],showQueue:[],showingQueue:!1,isShown:!1,spinny:function(t){var e=$("#"+StatusSpinny.spinnyID);return 0===e.length&&(e=$('<div id="'+StatusSpinny.spinnyID+'"></div>').appendTo(document.body)),"boolean"==typeof t&&e[t?"addClass":"removeClass"](StatusSpinny.spinningClass),e},show:function(t,e,i,n){void 0!==i&&null!=i||(i=""),StatusSpinny.resetTimeouts();var a=function(){StatusSpinny.isShown=!0,StatusSpinny.spinny(e).html(i).fadeIn(t),"number"==typeof n&&StatusSpinny.timeout(n)};StatusSpinny.isShown?StatusSpinny.scheduleShow(i,a):a()},scheduleShow:function(t,e){if(StatusSpinny.showQueue.push({message:t,fn:e}),!StatusSpinny.showingQueue){StatusSpinny.showingQueue=!0;var i=function(){StatusSpinny.hide(100,null,(function(){if(StatusSpinny.showQueue.length>2){for(var t=StatusSpinny.showQueue.shift();StatusSpinny.showQueue.length>1&&t.message==StatusSpinny.showQueue[1].message;)StatusSpinny.showQueue=StatusSpinny.showQueue.slice(2);t.fn()}else{if(!(StatusSpinny.showQueue.length>0))return StatusSpinny.showingQueue=!1,null;StatusSpinny.showQueue.shift().fn()}window.setTimeout(i,1500)}))};i()}},wouldShowAfter:function(t,e,i,n,a){var r=StatusSpinny.timeoutId(),s=StatusSpinny.spinny();return s.on(r,(function(){StatusSpinny.show(e,i,n,a)})),window.setTimeout((function(){s.trigger(r)}),t),r},hide:function(t,e,i){void 0!==e&&"string"==typeof e&&StatusSpinny.spinny().off(e),void 0===t&&(t="fast"),StatusSpinny.spinny().fadeOut(t,i),StatusSpinny.isShown=!1},timeout:function(t){var e=StatusSpinny.timeoutId(),i=StatusSpinny.spinny();i.on(e,StatusSpinny.hide),StatusSpinny.timeouts.push(e),window.setTimeout((function(){i.trigger(e)}),t)},resetTimeouts:function(){for(;StatusSpinny.timeouts.length>0;)StatusSpinny.spinny().off(StatusSpinny.timeouts.shift())},timeoutId:function(){return(new Date).getTime()+""+Math.random()},zzz:null},TaskQueue=function(){this.queue=[]};TaskQueue.prototype.addTask=function(t,e){this.queue.push({task:t,delay:e})},TaskQueue.prototype.run=function(){var t=this.queue.shift(),e=this;t&&setTimeout((function(){t.task(),e.run()}),t.delay)};var PromiseQueue=function(){this._queue=[]};PromiseQueue.prototype.add=function(t){this._queue.push(t),1===this._queue.length&&this.execute()},PromiseQueue.prototype.execute=function(){var t=this;if(0!==this._queue.length){var e=this._queue[0];e().then((function(){t._queue.splice(t._queue.indexOf(e),1),t.execute()}))}};var Templ=function(){"use strict";var t=function(){var t=document.querySelector("#pagedata");return t&&JSON.parse(t.dataset.blob)},e="en",i=t(),n=window.Translate&&Translate.locale||i&&i.locale||e,a=n!==e?"."+n:"",r="(http://|https://)?",s="(([^@\\./\\s\\/'\"><&]+)(\\.[^@\\./\\s\\/'\"><&]+)*(\\.[a-z]{2,}))",o="(?::\\d+)?",l="(/[^?\\s]*?)?",u="(\\?[^#\\s]*?)?",c="(#[^\\s]*?)?",h="(\\))?",d="([.,;](\\s|$)|\\s+|$)",p=new RegExp("(\\s+|^)(\\()?"+r+s+o+l+u+c+h+d+"|(\\s+\\(?|^\\(?)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)(\\)?\\s+|\\)?$)","i"),_=new RegExp("(\\s+|^)(\\()?"+r+s+o+l+u+c+h+d),m={".com":!0,".ru":!0,".org":!0,".net":!0,".de":!0,".jp":!0,".uk":!0,".br":!0,".it":!0,".pl":!0,".fr":!0,".in":!0,".au":!0,".ir":!0,".info":!0,".nl":!0,".cn":!0,".es":!0,".cz":!0,".kr":!0,".ca":!0,".eu":!0,".ua":!0,".co":!0,".gr":!0,".za":!0,".ro":!0,".biz":!0,".ch":!0,".se":!0,".tw":!0,".mx":!0,".vn":!0,".hu":!0,".be":!0,".tr":!0,".at":!0,".dk":!0,".tv":!0,".me":!0,".ar":!0,".sk":!0,".no":!0,".us":!0,".fi":!0,".id":!0,".cl":!0,".xyz":!0,".io":!0,".pt":!0,".by":!0,".il":!0,".ie":!0,".nz":!0,".kz":!0,".hk":!0,".lt":!0,".cc":!0,".my":!0,".sg":!0,".club":!0,".bg":!0,".edu":!0,".pk":!0,".su":!0,".top":!0,".th":!0,".hr":!0,".rs":!0,".pe":!0,".pro":!0,".si":!0,".lv":!0,".az":!0,".pw":!0,".ae":!0,".ph":!0,".online":!0,".ng":!0,".ee":!0,".ws":!0,".ve":!0,".pizza":!0,".cat":!0},f=new RegExp("(^|\\.)("+["bandcamp\\.com","bigcartel\\.com","blogspot\\.com","dailymotion\\.com","facebook\\.com","instagram\\.com","myspace\\.com","patreon\\.com","soundcloud\\.com","spotify\\.com","tumblr\\.com","twitter\\.com","vimeo\\.com","wordpress\\.com","youtu\\.be","youtube\\.com"].join("|")+")$"),g=new RegExp("^www\\.(\\w+\\.("+["bandcamp\\.com","blogspot\\.com","bigcartel\\.com","tumblr\\.com","wordpress\\.com"].join("|")+"))$"),y=/(?:^|\.)bandcamp.com$/i,v=/\brel=["']([^"']*)["']/i,b=/\breferrerpolicy=["']/i,k=/(^|\s)\*(\S|\S.*?\S)\*(?=\s|$)/g;function w(t,e){t=""+t;var i="";for(k.lastIndex=0;;){var n=k.lastIndex,a=k.exec(t);if(!a){i+=t.substring(n,t.length);break}i+=t.substring(n,a.index),i+=a[1],e&&(i+="<"+e+">"),i+=a[2],e&&(i+="</"+e+">")}return i}return{cfgFlags:i&&i.cfg||{},locale:n,locale_suffix:a,templates:{},globals:null,register:function(t){Object.assign(Templ.templates,t)},getGlobals:function(){if(!Templ.globals){var e=t(),i=e&&e.templglobals,n="undefined"!=typeof TemplGlobals?TemplGlobals:null;Templ.globals=Object.assign({},n,i)}return Templ.globals},RENDER_SPEED_TEST:!1,render:function(t,e){var i=Object.assign({},Templ.getGlobals(),e),n=new Templ.Context(i),a=[];if(this.RENDER_SPEED_TEST){Log.debug(">>> start rendering "+t);for(var r=new Date,s=0;s<100;++s)a=[],Templ.renderInternal(t,n,a);var o=new Date;Log.debug(">>> end rendering "+t+" - "+(o-r)/100+"ms")}else Templ.current_context=n,Templ.renderInternal(t,n,a),Templ.current_context=null;return a.join("")},runWithContext:function(t){var e=new Templ.Context(Templ.getGlobals());Templ.current_context=e,t(),Templ.current_context=null},renderElem:function(t,e,i){(t=elt(t)).innerHTML=Templ.render(e,i)},renderTableRow:function(t,e,i){t=elt(t);var n=document.createElement("DIV");n.innerHTML="<table><tbody><tr>"+Templ.render(e,i)+"</tr></tbody></table>";for(var a=n.firstChild.firstChild.firstChild;null!=t.firstChild;)t.removeChild(t.firstChild);for(;null!=a.firstChild;)t.appendChild(a.removeChild(a.firstChild))},renderInternal:function(t,e,i){var n=Templ.templates[t+Templ.locale_suffix]?Templ.templates[t+Templ.locale_suffix]:Templ.templates[t];if(n)Templ.renderTokens(n,e,i);else{var a="[template not found: "+t+"]";i.push(a),Log.server(a,"warn")}},renderTokens:function(t,e,i){if(t)for(var n=0;n<t.length;n++){var a=t[n];if("string"==typeof a)i.push(a);else try{Templ.renderOneToken(a,e,i)}catch(t){throw Log.error("Error rendering token",a,"context",e),t}}},renderOneToken:function(t,e,i){var n,a;switch(t.type){case"translate":Templ.renderTokens(t.nodelist,e,i);break;case"translatePlural":for(n=0;n<t.blocks.length;n++)if(a=t.blocks[n],Templ.evalNCondition(a,e)){Templ.renderTokens(a.attachment,e,i);break}break;case"translateVariable":Templ.renderTokens(t.nodelist,e,i);break;case"variable":if(!t.name)return;var r=Expression.eval(t.name,(function(t){return e.resolve(t)})),s=Templ.filters;Iter.each(t.filters,(function(t){var i=Iter.collect(t[1],(function(t){return e.resolve(t)})),n=t[0]?s[t[0]]:null;n?(i.unshift(r),r=n.apply(null,i)):(r="[template error: filter not found: "+t[0]+"]",Log.error(r))})),null!=r&&(Array.isArray(r)&&(r=r.join("")),i.push(r));break;case"assign":e.hash[t.to]=e.resolve(t.from);break;case"case":case"if":var o=t.blocks;for(n=0;n<o.length;n++)if(a=o[n],Templ.evalCondition(a,e)){Templ.renderTokens(a.attachment,e,i);break}break;case"for":var l=e.resolve(t.collection_name);l instanceof Templ.Range&&(l=l.expand());var u=t.nodelist,c=null!=t.attribs.offset?e.resolve(t.attribs.offset):0,h=l?l.length-c:0;null!=t.attribs.limit&&(h=Math.min(h,e.resolve(t.attribs.limit)));var d=l?l.slice(c,c+h):[];for(t.reversed&&d.reverse(),e.stashLoopvars(),n=0;n<h;n++)e.hash[t.variable_name]=d[n],e.hash.forloop={length:h,index:n+1,index0:n,rindex:h-n,rindex0:h-n-1,first:0===n,last:n===h-1},Templ.renderTokens(u,e,i);e.restoreLoopvars();break;case"include":var p=e.resolve(t.template_name);Templ.renderInternal(p,e,i);break;case"capture":var _=[];Templ.renderTokens(t.nodelist,e,_);var m="";for(n=0;n<_.length;n++)m+=_[n];e.hash[t.to]=m;break;case"ef":for(o=t.blocks,n=0;n<o.length;n++)if(a=o[n],Templ.evalNCondition(a,e)){Templ.renderTokens(a.attachment,e,i);break}break;case"let":e.hash[t.variable]=Expression.eval(t.expression,(function(t){return e.resolve(t)}))}},evalNCondition:function(t,e){return"else_ncondition"==t.type||Templ.isTrue(Expression.eval(t.expression,(function(t){return e.resolve(t)})))},evalCondition:function(t,e){if("else_condition"==t.type)return!0;var i,n=e.resolve(t.left),a=t.operator;if(a){var r=Templ.operators[a];if(!r)return Log.error("template: unrecognized operator: "+a),!1;i=r(n,e.resolve(t.right))}else i=Templ.isTrue(n);return"or"==t.child_relation?i=Templ.isTrue(i)||Templ.isTrue(Templ.evalCondition(t.child_condition,e)):"and"==t.child_relation&&(i=Templ.isTrue(i)&&Templ.isTrue(Templ.evalCondition(t.child_condition,e))),i},isTrue:function(t){return!1!==t&&null!=t},EMPTY:{equals:function(t){return t==this||(!t||""===t.toString())}},Range:function(t,e){this.start=t,this.end=e,this.expand=function(){for(var t=[],e=this.start;e<=this.end;e++)t.push(e);return t}},operators:{"==":D,"!=":function(t,e){return!D(t,e)},"<>":function(t,e){return!D(t,e)},"<":function(t,e){return Expression.evaluate_comparison("<",t,e)},">":function(t,e){return Expression.evaluate_comparison(">",t,e)},"<=":function(t,e){return Expression.evaluate_comparison("<=",t,e)},">=":function(t,e){return Expression.evaluate_comparison(">=",t,e)},contains:function(t,e){if("string"==typeof t)return t.indexOf(e)>=0;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}return t instanceof Templ.Range&&(e>=t.start&&e<=t.end)}},filters:{size:function(t){return t?t.length:0},downcase:function(t){return null!=t?t.toString().toLowerCase():""},upcase:function(t){return null!=t?t.toString().toUpperCase():""},escape:function(t){return null!=t?Text.escapeHtml(t.toString()):""},escape_html_attr:function(t){return Templ.filters.escape(t)},noblanks:function(t,e){return e?t.replace(/(\n *)+/g,"").replace(/\n--/g,"\n"):t.replace(/(\n *)+/g,"\n").replace(/\n--/g,"\n")},strip:function(t){return null!=t?t.toString().trim():""},strip_html:function(t){return null!=t?t.toString().replace(/<.*?>/g,""):""},strip_newlines:function(t){return null!=t?t.toString().replace(/\n/g,""):""},newline_to_br:function(t){return null!=t?t.toString().replace(/\n/g,"<br />\n"):""},newline_to_gap:function(t,e){var i=e?/(\n[\r\t ]*)+\n/g:/\n[\r\t ]*\n/g;return null!=t?t.toString().replace(i,'<br /><span class="lightweightBreak" /></span><br />').replace(/\n/g,"<br />\n"):""},replace:function(t,e,i){return Templ.filters.replace_regex(t,Text.regexpEscape(e),i)},replace_regex:function(t,e,i){return null==t?"":(null==i&&(i=""),(t=t.toString()).replace(new RegExp(e,"gm"),i))},replace_first:function(t,e,i){return null==i&&(i=""),null!=t?t.toString().replace(e,i):""},remove:function(t,e){return Templ.filters.replace(t,e)},remove_first:function(t,e){return Templ.filters.replace_first(t,e)},encode_uri_c:function(t){return null!=t?encodeURIComponent(t).replace(/'/g,"%27"):""},join:function(t,e){return null==e&&(e=" "),Array.isArray(t)?t.join(e):t},sort:function(t){return Array.isArray(t)?t.slice(0).sort((function(t,e){return t>e?1:t<e?-1:0})):t},first:function(t){return Array.isArray(t)?t[0]:null},last:function(t){return Array.isArray(t)&&t.length?t[t.length-1]:null},edit_if_empty:function(t,e,i,n){return t&&t.length>0?t:Templ.filters.edit_field(n,e,i)},edit_field:function(t,e,i){return'<a href="/edit?id='+e+"&focus="+i+'">'+t+"</a>"},date:function(t,e){return"string"==typeof t&&(t=new Date(Date.parse(t))),Time.strftime(t,e)},time:function(t,e,i){return Time.to_ui(t,e,n,i)},ui_datetime:function(t){return t?Time.toUi(t,!1,!0):""},ui_date:function(t,e){return t?Time.toUiDate(t,e,!0):""},to_date:function(t){return new Date(1e3*t)},relative_day:function(t,e){return t?Time.relative_day(t,e,n):""},relative_time:function(t,e){return t?Time.relative_time(t,e,n):""},relative_duration:function(t,e){return t?Time.relative_duration(t,e,n):""},json:function(t){return JSON.stringify(t)},plural:function(t,e,i){return null==i&&(i=e+"s"),"1"==t?e:i},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},capitalize_first_character:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},titlecase:function(t){return null!=t?t.toString().replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})):""},currency:function(t,e,i,n,a){return null==t?"":TextFormat.currency(t,window.CurrencyData?CurrencyData.info[e||"USD"]:null,i,n,a)},money:function(t,e,i){return TextFormat.money(t,e,i)},million_usd:function(t){return TextFormat.million_usd(t,n)},negate:function(t){return t&&t.is_money?{amount:-t.amount,currency:t.currency,is_money:!0}:"number"==typeof t?-t:""},abs:function(t){return t&&t.is_money?{amount:Math.abs(t.amount),currency:t.currency,is_money:!0}:"number"==typeof t?Math.abs(t):""},truncate:function(t,e,i){return i=i||"...",Text.truncate(t,e,i)},add_query_parm:function(t,e){return t?null===e||0===e.length?t:t+(t.indexOf("?")>-1?"&":"?")+e:""},mb:function(t){return TextFormat.toMb(t)},mb_si:function(t){return TextFormat.toMb(t,!0)},url:function(t,e,i){var n=e?"https_url":"url";return i&&("_"!=(i+="").charAt(i.length-1)&&(i+="_"),n=i+n),t[n]},commafy:function(t){return TextFormat.commafyNumber(""+t)},smallest_number_text:function(t,e){var i=parseInt(t),n=i.toString();if(isNaN(i)||n.length<=e)return TextFormat.commafyNumber(n);var a=Math.floor(i/1e3*10)/10;if(a>0&&(n=a+"K"),n.length<=e)return n;if((a=Math.floor(a))>0&&(n=a+"K"),n.length<=e||i<1e6)return n;var r=Math.floor(i/1e6*10)/10;return(n=r+"M").length<=e||(n=(r=Math.floor(r))+"M"),n},fan_link:function(t,e){return"<a href='"+t.trackpipe_url+"' style='"+e+"'>"+t.name+"</a>"},add_product_utm:function(t,e){var i="";if(!t)return i;for(var n,a=0,r=t;a<300&&(n=_.exec(r));)if(a++,i+=r.substring(0,n.index),r=r.substring(n.index+n[0].length),n[3]||m[n[7].toLowerCase()]){var s=[n[3]||"http://",n[4],n[8],n[9],n[10],n[11]].join(""),o="";"("===n[2]&&")"===s[s.length-1]&&(s=s.substring(0,s.length-1),o=")"),i+=(n[1]||"")+(n[2]||""),i+=s,i+=o,i+=void 0===n[12]?" ":n[12]}else i+=n[0];return i+=r},highlight_mention:function(t,e){return t.split("@"+e).join("<span class='mention-highlight'>@"+e+"</span>")},html_autolink:function(t,e,i){i=i||!0;var n="";if(!t)return n;e?" "!==e[0]&&(e=" "+e):e="",t=t.replace(/ +/g," ");for(var a,r=0,s=i?p:_,o=t;r<300&&(a=s.exec(o));){if(r++,n+=Text.escapeHtml(o.substring(0,a.index)),o=o.substring(a.index+a[0].length),a[15])n+=" ",n+=Text.escapeHtml(a[14].substring(a[14].length-1)),n+='<a href="mailto:',n+=Text.escapeHtml(a[15]),n+='">',n+=Text.escapeHtml(a[15]),n+="</a>",n+=Text.escapeHtml(void 0===a[17]?" ":a[17]);else{if(!a[3]&&!m[a[7].toLowerCase()]){n+=a[0];continue}var l="https://"==a[3]||f.test(a[4])?"https://":"http://",u=a[4].replace(g,"$1"),c=a[9]&&"?"+a[9].substr(1).split("&").filter((function(t){return"utm_"!==t.substr(0,4)})).join("&"),h=[u,"/"===a[8]?"":a[8],c,a[10],a[11]].join(""),d=[l,u,a[8],a[9],a[10],a[11]].join(""),y="";"("===a[2]&&")"===d[d.length-1]&&(d=d.substring(0,d.length-1),h=h.substring(0,h.length-1),y=")"),n+=" ",n+=Text.escapeHtml((a[1]||"")+(a[2]||"")),n+='<a href="',n+=Text.escapeHtml(d),n+='"',n+=T(h,e),n+=">",n+=Text.escapeHtml(h),n+="</a>",n+=y,n+=Text.escapeHtml(void 0===a[12]?" ":a[12])}n+=" "}return n+=Text.escapeHtml(o)},plus:function(t,e){return t+e},minus:function(t,e){return t-e},times:function(t,e){return t*e},divided_by:function(t,e){return t==Math.floor(t)&&e==Math.floor(e)?Math.floor(t/e):t/e},image:function(t,e){var i="number"==typeof t||!t,n=i?t:t.image_id,a=Templ.filters.image_url(n,e);if(i)return'src="'+a+'"';var r=ImageUtils.imageDimensions(t.width,t.height,e);return'src="'+a+'" width="'+r.width+'" height="'+r.height+'"'},image_url:function(t,e){return ImageUtils.imageURL(t,e,Templ.current_context.resolve("is_https"))},art:function(t,e){return'src="'+Templ.filters.art_url(t,e)+'"'},art_url:function(t,e){return ImageUtils.artURL(t,e,Templ.current_context.resolve("is_https"))},popup_image:function(t,e){var i="number"==typeof t,n=i?t:t.image_id,a=Templ.filters.image_url(n,e);if(i)return'href="'+a+'"';var r=ImageUtils.imageDimensions(t.width,t.height,e);return'href="'+a+'" data-image-size="'+r.width+","+r.height+'"'},image_width:function(t,e){return ImageUtils.imageDimensions(t.width,t.height,e).width},image_height:function(t,e){return ImageUtils.imageDimensions(t.width,t.height,e).height},possessify:function(t){return null===t||"string"!=typeof t||n&&n!=e?t:/s$/.test(t)?t+"'":t+"'s"},possessify_smart:function(t){return null===t||"string"!=typeof t||n&&n!=e?t:/s$/.test(t)?t+"’":t+"’s"},enumerate_items:function(t,e){void 0===e&&(e="and");var i=function(t){return 0===t.length||null===t?"":1===t.length?t[0]:2===t.length?t[0]+" "+e+" "+t[1]:t[0]+", "+i(t.slice(1,t.length))};return i(t)},fan_page_url:function(t){return Templ.current_context.resolve("siteroot_current")+"/"+t},band_url:function(t){if(!t)return"";var e=t.custom_domain,i=t.custom_domain_verified,n=t.subdomain,a=Templ.current_context.resolve("custom_domains_active"),r=Templ.current_context.resolve("base_port_str")||"",s=Templ.current_context.resolve("sitedomain");return a&&e&&i?"https://"+e+r:n?location.protocol+"//"+n+"."+s:""},lpad:function(t,e){void 0===e&&(e=10);var i=(t=String(t)).length,n="";return e-i>0&&(n=new Array(e-i+1).join(" ")),n+t},asterisks_to_em:function(t){return w(t,"em")},strip_asterisks:function(t){return w(t,null)},tralbum_url:function(t){if(!t)return"";var e="";switch(t.item_type){case"a":e="/album/";break;case"t":e="/track/";break;case"p":e="/merch/";break;case"c":e="/campaign/"}return Templ.filters.band_url(t)+e+t.slug},subscribe_url:function(t){if(!t)return"";var e=t.subscribe_url_fragment||"subscribe";return Templ.filters.band_url(t)+"/"+e},featured_track_url:function(t,e){return t?Templ.filters.tralbum_url(t)+"?t="+e:""},hex_to_rgb:function(t){if(!t)return null;if("#"===t[0]&&(t=t.substring(1)),!t.match(/[0-9A-Fa-f]{6}/))return null;var e=parseInt(t,16);return(e>>16&255)+", "+(e>>8&255)+", "+(255&e)},fixnum:function(t,e){return t.toFixed(e)},wrap_emojis:function(t){const e=/(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5-\uDED7\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])\uFE0F/g;return t.match(e)&&!t.match(/\u270C/g)?"<span>"+t.replace(e,(function(t){return"<span class='emoji'>"+t+"</span>"}))+"</span>":t}},Context:function(t){this.hash=t||{},this.loopvars=null}};function D(t,e){return t==Templ.EMPTY?t.equals(e):e==Templ.EMPTY?e.equals(t):Expression.evaluate_comparison("==",t,e)}function T(t,e){var i,n=t.split("/")[0];if(y.test(n))return e;if(i=v.exec(e)){var a=i[1];-1===a.indexOf("nofollow")&&(a+=" nofollow ugc"),e=e.substring(0,i.index)+'rel="'+a+'"'+e.substring(i.index+i[0].length)}else e+=' rel="nofollow ugc"';return b.test(e)||(e+=' referrerpolicy="strict-origin-when-cross-origin"'),e}}();Templ.filters.h=Templ.filters.escape,Templ.filters.a=Templ.filters.attr=Templ.filters.escape_html_attr,Templ.filters.u=Templ.filters.encode_uri_c,Templ.Context.prototype=function(){"use strict";var t=/\[[^\]]+\]|[\w-]+\??/g,e=/^\[(.+)\]$/;return{resolve:function(t){switch(t){case null:case"nil":case"null":case"":return null;case"true":return!0;case"false":return!1;case"empty":return Templ.EMPTY}var e;return(e=/^'(.*)'$/.exec(t))||(e=/^"(.*)"$/.exec(t))?e[1]:/^\d+$/.test(t)?parseInt(t):(e=/^\((\S+)\.\.(\S+)\)$/.exec(t))?new Templ.Range(this.resolve(e[1]),this.resolve(e[2])):/^(\d[\d\.]+)$/.test(t)?parseFloat(t):this.variable(t)},variable:function(i){var n=t.lastIndex;t.lastIndex=0;var a,r,s,o=this.hash;try{for(;a=t.exec(i);)s=a[0],(r=e.exec(s))&&(s=this.resolve(r[1])),o="size"!==s&&"first"!==s&&"last"!==s||o&&"object"==typeof o&&o.hasOwnProperty(s)?o&&o[s]:Templ.filters[s](o);return o}finally{t.lastIndex=n}},stashLoopvars:function(){var t=this.hash.forloop;t&&(this.loopvars=this.loopvars||[],this.loopvars.push(t))},restoreLoopvars:function(){this.loopvars&&(this.hash.forloop=this.loopvars.pop())}}}();var HTMLEmbeddedPlayer3=function(){function t(t,i,a){var r=this;for(var s in this._playlist=t,this._params=i,this._playerdata=a,this._tracklistelems=[],this._artist=a.artist,this._elems={},this._root_elem=document.getElementById("player"),n){var o=n[s];this._elems[o]=document.getElementById(o)}this._albumtitle=a.album_title,this._is_exclusive=!!i.esig||!!i.fesig,this.effectively_single_track=!1,this._is_exclusive&&this._playlist.first_playable_track===this._playlist.last_playable_track&&(this.effectively_single_track=!0),this._hookup_ui(),i.bgcol&&(i.transparent||(this._elems.player.style.background="#"+i.bgcol),Color.isDark(i.bgcol)&&(e(document.body,"invertIconography"),e(this._root_elem,"theme-dark")));var l=i.twittercard&&"true"==i.twittercard,u=a.linkback+"?from="+(l?"twittercard":"embed")+(i.daily?"&context=daily":""),c="";if(i.campaign&&""!=i.campaign&&i.campaign.length<=50&&/^[a-z0-9_-]+$/.test(i.campaign)&&(u+=c="&campaign="+i.campaign),this._elems.maintextlink.href=u,this._elems.subtextlink.href=u,this._elems.tracknamelink.href=u,this._elems.artlink.href=u,$(this._root_elem).find(".artlink").attr("href",u),this._elems.infolink.href=u,$(this._root_elem).find(".logo").attr("href",u),this._elems.logoalt.href=u,this._elems.logoalt2.href=u,this._elems.buyordownloadlink.href=a.linkback+"?action="+(a.linkback_action?a.linkback_action:"download")+"&from="+(l?"twittercard":"embed")+(i.daily?"&context=daily":"")+c,this._elems.buyordownloadlinkalt.href=this._elems.buyordownloadlink.href,this._elems.sharelink.href=a.linkback+"?action=share&from="+(l?"twittercard":"embed")+(i.daily?"&context=daily":"")+c,this._elems.sharelinkalt.href=this._elems.sharelink.href,$(this._elems.sharelink).click(this._makehandler("_handle_share_click")),$(this._elems.sharelinkalt).click(this._makehandler("_handle_share_click")),a.linkback_action){var h="buy"==a.linkback_action?"buy":"download";$(this._root_elem).addClass(h),this._is_exclusive?(a.is_preorder?$(this._root_elem).addClass("preorder"):$(this._root_elem).addClass("optional-streaming"),this._elems.buyordownloadlink.innerHTML="buy"==a.linkback_action?1==a.is_preorder?"pre-order":"buy":"download",this._elems.buyordownloadlinkalt.innerHTML="buy"==a.linkback_action?1==a.is_preorder?"pre-order":"buy":"download"):(a.is_preorder&&$(this._root_elem).addClass("preorder"),this._elems.buyordownloadlink.innerHTML="buy"==a.linkback_action?1==a.is_preorder?"pre-order":"buy":"download",this._elems.buyordownloadlinkalt.innerHTML="buy"==a.linkback_action?1==a.is_preorder?"pre-order":"buy":"download")}else this._elems.buyordownload.style.display="none",this._elems.buyordownloadalt.style.display="none";var d=null;if(i.album&&i.track)for(var p=Number(i.track),_=0;_<t.length();_++){if((f=t.get_track_info(_)).id==p){i.t=_+1;break}}if(i.t){var m=Number(i.t)-1;m>=0&&m<t.length()&&(d=m,t.set_initial_track(d))}if(null!=d&&"small"==i.size&&i.album){var f=t.get_track_info(d);this._elems.tracknamelink.href=f.title_link,t.load([f])}else for(_=0;_<t.length();_++){f=t.get_track_info(_);var g=this._create_playlist_item(f),y=this;f.file?$(g).click(function(t){return function(){y._playlist.play_track(t)}}(_)):$(g).addClass("nostream"),$(this._elems.tracklist_ul).append(g),this._tracklistelems[f.tracknum+1]=g}var v=i.width;v&&v.match(/^[0-9]+$/)&&$(this._root_elem).css("width",v+"px");var b=i.size,k=i.artwork,w=!("large"!=b&&"medium"!=b||"none"!=k&&"false"!=k),D="medium"==b&&"none"!=k&&"false"!=k;if("large"==b&&"true"!=i.notracklist&&"false"!=i.tracklist&&$(this._root_elem).addClass("hastracklist"),w&&$(this._root_elem).addClass("noartwork"),D&&$(this._root_elem).addClass("smallartwork"),i.package&&a.packages){e(this._root_elem,"hasmerch");var T=Number(i.package);for(_=0;_<a.packages.length;_++){var x=a.packages[_];if(x.id==T){if(this._package=x,x.arts)for(var S=0;S<x.arts.length;S++){var E=x.arts[S];if(E){var C=document.createElement("div"),M=ImageUtils.imageURL(E.image_id,"art_thumbthumb");e(C,"merchthumb"),C.style.backgroundImage="url("+M+")";var P=function(t,e,i){var n=i;return function(i){$(".merchthumb").removeClass("selected"),t._showing_package_image!=e&&$(n).addClass("selected"),U.stopEvent(i),t.toggle_package_image(e)}}(this,S,C);$(C).click(P),this._elems.merch.appendChild(C)}}break}}}this.isAlbum()?this.effectively_single_track?e(this._root_elem,"standalonetrackplayer"):e(this._root_elem,"albumplayer"):$(this._root_elem).is(".classic")?e(this._root_elem,"trackplayer"):this._albumtitle&&""!=this._albumtitle?e(this._root_elem,"albumtrackplayer"):e(this._root_elem,"standalonetrackplayer"),this._is_exclusive&&e(this._root_elem,"exclusive"),this._choose_size_classes(),this._root_elem.style.display="block",this._switch_track_artwork(d),this._setup_infolayer(),this._adjust_tracklist(),$(window).resize((function(){r._choose_size_classes(),r._setup_infolayer(),r._adjust_tracklist()}));try{window.parent.postMessage("playerinited","*")}catch(t){Log.warn("failed to postMessage: "+t)}}t.prototype={_switch_track_artwork:function(t){var e=this;$(this._root_elem).find(".art, #art").each((function(i,n){if((n=$(n)).is(":visible")){var a=n.width(),r=n.attr("id"),s=e._track_art_url(t,a);"art"==r&&(a=$(e._elems.art).width(),s=e._track_art_url(t,a),e._original_art=s,e._showing_package_image)||n.css("backgroundImage","url("+s+")")}}))},toggle_package_image:function(t){if(this._showing_package_image==t)this._elems.art.style.backgroundImage="url("+this._original_art+")",this._showing_package_image=null;else{var e=this._package;this._elems.art.style.backgroundImage="url("+ImageUtils.imageURL(e.arts[t].image_id,"screen")+")",this._showing_package_image=t}},_hookup_ui:function(){$(this._elems.play).click(this._makehandler("_handle_play_click")),$(this._elems.tinyplayer).click(this._makehandler("_handle_tiny_click")),$(this._elems.next).click(this._makehandler("_handle_next_click")),$(this._elems.prev).click(this._makehandler("_handle_prev_click")),$("#artlink").click(this._makehandler("_handle_art_click")),$(".artlink").click(this._makehandler("_handle_art_click")),$("#artarea").click(this._makehandler("_handle_art_click")),$(".art").click(this._makehandler("_handle_art_click")),this._playlist.onstatechanged(this._handle_playlist_statechanged,this),this._playlist.ontime(this._handle_playlist_time,this),this._playlist.onloaded(this._handle_playlist_loaded,this),this._playlist.ontrackchanged(this._handle_playlist_trackchanged,this),this._playlist.onplaylistchanged(this._handle_playlist_playlistchanged,this);var t=this._playlist.get_track();this._handle_playlist_trackchanged(this._playerdata.tracks[t]),this._handle_playlist_time({position:0}),$("#shareurl").focus((function(){$(this).select().one("mouseup",(function(t){$(this).unbind("keyup"),t.preventDefault()})).one("keyup",(function(){$(this).select().unbind("mouseup")}))})),this._is_phone()?$(this._elems.timeline).on("touchstart",this._makehandler("_handle_seek_touchstart")):$(this._elems.progbar_thumb).draggable({start:this._makehandler("_handle_thumb_startdrag"),drag:this._makehandler("_handle_thumb_drag"),stop:this._makehandler("_handle_thumb_enddrag"),containment:"parent",axis:"x"})},_adjust_tracklist:function(){if($(this._root_elem).hasClass("has_info_slider"))$(this._root_elem).removeClass("hastracklist");else{var t=$(this._root_elem).height(),e=$(this._elems.tracklist),i=$(this._elems.infolayer),n=i.position().top+i.outerHeight(),a=e.position().top,r=(e.outerHeight(),$("#nonartarea").outerHeight()-$("#nonartarea").height());e.css("height",t-n-r+"px")}},_scroll_tracklist:function(t){var e=$("#tracklist"),i=$("#tracklist li")[t-1];if(i){var n=$(i).position().top-$("#tracklist").position().top,a=n+$(i).outerHeight(),r=e.scrollTop(),s=e.outerHeight();n<0?e.scrollTop(r+n):a>s&&e.scrollTop(r+a-s)}},_setup_infolayer:function(){i(this._root_elem,"has_info_slider"),i(this._elems.infolayer,"fixed");var t=$(this._elems.infolayer),n=$("#artarea").width(),a=$("#artarea").height(),r=$(this._root_elem).width(),s=$(this._root_elem).height();if(s>a||r>n)e(this._elems.infolayer,"fixed");else{var o=t.position(),l=o.left,u=o.top,c=t.outerWidth(),h=t.outerHeight();this._infolayer_show_x=null,this._infolayer_show_y=null,l<0?this._infolayer_show_x=0:l>=r&&(this._infolayer_show_x=r-c),u<0?this._infolayer_show_y=0:u>=s&&(this._infolayer_show_y=s-h),null==this._infolayer_show_x&&null==this._infolayer_show_y||(e(this._root_elem,"has_info_slider"),this._infolayer_hide_x=l,this._infolayer_hide_y=u,null===this._infolayer_show_x&&(this._infolayer_show_x=l),null===this._infolayer_show_y&&(this._infolayer_show_y=u),t.css({left:l+"px",top:u+"px",bottom:"auto"}),$(this._root_elem).on("mouseenter",this._makehandler("_handle_hover")).on("mouseleave",this._makehandler("_handle_unhover")),$(window).resize(this._makehandler("_handle_doc_resize")))}},_choose_size_classes:function(){i(this._elems.play,"big"),$(this._elems.play).width()>35&&e(this._elems.play,"big")},_handle_doc_resize:function(){if(this._infolayer_hide_x>0){var t=$(this._root_elem).width()-this._infolayer_hide_x;this._infolayer_hide_x+=t,this._infolayer_show_x+=t}if(this._infolayer_hide_y>0){var e=$(this._root_elem).height()-this._infolayer_hide_y;this._infolayer_hide_y+=e,this._infolayer_show_y+=e}(this._infolayer_hide_x>0||this._infolayer_hide_y>0)&&this._handle_unhover()},_makehandler:function(t){var e=this;return function(i){e[t].apply(e,[i])}},_handle_hover:function(){$(this._root_elem).hasClass("has_info_slider")&&$(this._elems.infolayer).stop(!0,!1).delay(400).animate({left:this._infolayer_show_x+"px",top:this._infolayer_show_y+"px",opacity:"1"},"fast","linear")},_handle_unhover:function(){$(this._root_elem).hasClass("has_info_slider")&&$(this._elems.infolayer).stop(!0,!1).delay(1e3).animate({left:this._infolayer_hide_x,top:this._infolayer_hide_y,opacity:"0"})},_handle_play_click:function(t){U.stopEvent(t),this._playlist.playpause(),this._hasplayed()},_handle_tiny_click:function(t){"tinyplayer"==t.target.id&&this._handle_play_click(t)},_handle_next_click:function(t){U.stopEvent(t),this._playlist.next_track(),this._playlist.play(),this._hasplayed()},_handle_prev_click:function(t){U.stopEvent(t),this._playlist.prev_track(),this._playlist.play(),this._hasplayed()},_handle_art_click:function(t){U.stopEvent(t),this._classic||(t.preventDefault(),this._playlist.playpause(),this._hasplayed())},_handle_share_click:function(t){var e=$(this._root_elem).width(),i=$(this._root_elem).height();!$(playerui._root_elem).is(".classic")&&e>=300&&i>=300&&(U.stopEvent(t),$("#sharedialog").dialog({width:"280px",height:210,modal:!0,position:{at:"center",of:"#artarea"},open:function(t,e){$(".ui-widget-overlay").bind("click",(function(){$("#sharedialog").dialog("close")})),this._social_controls_inited||(SocialControls.initFromDOM($("#sharedialog")),$(".share-embed-container").show(),this._social_controls_inited=!0)}}))},_handle_playlist_statechanged:function(t){switch(t.newstate){case"PLAYING":e(this._root_elem,"playing"),i(this._elems.play,"busy"),e(this._elems.play,"playing"),e(this._elems.tinyplayer,"playing");break;case"BUFFERING":case"BUSY":e(this._root_elem,"playing"),i(this._elems.play,"playing"),e(this._elems.play,"busy"),e(this._elems.tinyplayer,"playing");break;default:"COMPLETED"==t.newstate&&this._handle_playlist_time({position:0}),i(this._root_elem,"playing"),i(this._elems.tinyplayer,"playing"),i(this._elems.play,"busy"),i(this._elems.play,"playing")}},_handle_playlist_time:function(t){this._dragging||(this._trackpos=t.position),t.duration&&(this._tracklength=t.duration),this._updateprog()},_handle_playlist_loaded:function(t){this._loadpercent=t,this._updateprog()},_handle_playlist_trackchanged:function(t){this._trackinfo=t,this._tracklength=t.duration,this._songtitle=t.title||"";var n=this._tracklistelems[this._currentTrack];n&&i(n,"currenttrack"),this._currentTrack=t.tracknum+1,this._scroll_tracklist(this._currentTrack),(n=this._tracklistelems[this._currentTrack])&&e(n,"currenttrack"),$("#tracklist .currenttrack .currenttime").html(Time.timeStr(0)),this._numTracks=this._playlist.length,this._update_text(),this._updateprog(),this._showhide_nextprev(),this._switch_track_artwork(this._currentTrack-1)},_handle_playlist_playlistchanged:function(t){var e=this._playlist.get_track_info();e&&this._handle_playlist_trackchanged(e)},_handle_thumb_startdrag:function(t){this._dragging=!0,this._playlist.seeking=!0,this._dragoffset=t.pageX-$(t.target).offset().left},_handle_thumb_drag:function(t){var e=$(this._elems.timeline).offset().left,i=$(this._elems.timeline).width()-$(this._elems.progbar_thumb).width(),n=t.pageX-e-this._dragoffset;n<0?n=0:n>i&&(n=i),n*=this._tracklength/i,this._trackpos=n,this._updateprog()},_handle_thumb_enddrag:function(t){this._playlist.seek(this._trackpos),this._dragging=!1,this._playlist.seeking=!1,this._hasplayed()},_create_playlist_item:function(t){var e=$("<li>"),i=Text.escapeHtml(t.title);return t.artist&&""!=t.artist&&t.artist!=this._artist&&(i=Text.escapeHtml(t.artist)+" &mdash; "+i),e.append($("<span>",{class:"tracknum",text:t.tracknum+1+"."})),e.append($("<a>",{href:"#"}).append($("<span>",{class:"tracktitle",html:i})).append($("<span>",{class:"currenttime"})).append($("<span>",{class:"tracktime",text:Time.timeStr(t.duration)}))),e},_handle_seek_touchstart:function(t){t.preventDefault();var e=$(this._elems.timeline);this._seek_move_handler=this._makehandler("_handle_seek_touchmove"),this._seek_end_handler=this._makehandler("_handle_seek_touchend"),this._seek_cancel_handler=this._makehandler("_handle_seek_touchcancel"),e.on("touchmove",this._seek_move_handler),e.on("touchend",this._seek_end_handler),e.on("touchcancel",this._seek_cancel_handler),this._playlist.seeking=!0,this._dragging=!0,this._dragtimerhandler=this._makehandler("_handle_drag_timeout"),this._dragtimer=setTimeout(this._dragtimerhandler,1e3)},_handle_seek_touchmove:function(t){var e=t.originalEvent.changedTouches[0].pageX,i=this._elems.timeline,n=this._elems.progbar_thumb.clientWidth,a=n/2;do{a+=i.offsetLeft}while(i=i.offsetParent);var r=(e-a)/(a+this._elems.timeline.clientWidth-n-a);r>1?r=1:r<0&&(r=0),this._trackpos=this._tracklength*r,this._updateprog(),clearTimeout(this._dragtimer),this._dragtimer=setTimeout(this._dragtimerhandler,1e3)},_handle_seek_touchend:function(t){clearTimeout(this._dragtimer),this._finishdrag(!0)},_handle_seek_touchcancel:function(t){this._finishdrag(!1)},_handle_drag_timeout:function(t){this._finishdrag(!0)},_finishdrag:function(t){var e=$(this._elems.timeline);e.off("touchmove",this._seek_move_handler),e.off("touchend",this._seek_end_handler),e.off("touchcancel",this._seek_cancel_handler),this._playlist.seeking=!1,this._dragging=!1,t&&(this._trackpos==this._tracklength?this._playlist.next_track():0==this._trackpos&&this._seekorigpos<3?this._playlist.prev_track():this._playlist.seek(this._trackpos),this._hasplayed())},isAlbum:function(){return!!this._params.album},_update_text:function(){var t=Text.escapeHtml(this._songtitle||"");this._trackinfo.artist&&""!==this._trackinfo.artist&&this._trackinfo.artist!==this._artist?(t=Text.escapeHtml(this._trackinfo.artist)+" &mdash; "+t,this._elems.artist.innerHTML=Text.escapeHtml(this._trackinfo.artist)):this._elems.artist.innerHTML=Text.escapeHtml(this._artist||""),this.isAlbum()?(this._elems.maintextlink.innerHTML=Text.escapeHtml(this._albumtitle||""),this._elems.tracknamelink.innerHTML=Text.escapeHtml(this._songtitle||""),this._elems.currenttitle_title.innerHTML=t,this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."):(this._elems.maintextlink.innerHTML=Text.escapeHtml(this._songtitle||""),this._elems.currenttitle_title.innerHTML=t,this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."),this._elems.subtextlink.innerHTML=Text.escapeHtml(this._trackinfo.artist||""),this._elems.album.innerHTML=Text.escapeHtml(this._albumtitle||"")},_updateprog:function(){var t=$("#timeline .progbar_empty").width()-this._elems.progbar_thumb.offsetWidth,e=this._tracklength?this._trackpos/this._tracklength*t:0;if(this._elems.progbar_thumb.style.left=Math.round(e)+"px",this._elems.progbar_fill.style.width=(this._loadpercent||0)+"%",this._elems.currenttime.innerHTML=Time.timeStr(this._trackpos),this._elems.totaltime.innerHTML=Time.timeStr(this._tracklength>1?this._tracklength:1),!this._playlist.seeking){var i=this._loadpercent/100*this._tracklength,n=i>0?this._trackpos/i*100:0;this._elems.progbar_fill_played.style.width=n+"%"}$("#tracklist .currenttrack .currenttime").html(Time.timeStr(this._trackpos))},_showhide_nextprev:function(){var t=this._playlist.get_track(),e=this._playlist.first_playable_track,i=this._playlist.last_playable_track;this._elems.prev&&this.showhide_elem(this._elems.prev,e>=0&&t>e),this._elems.next&&this.showhide_elem(this._elems.next,i>=0&&t<i)},showhide_elem:function(t,n){n?i(t,"hiddenelem"):e(t,"hiddenelem")},_is_phone:function(){return"phone"==Browser.media_mode},_hasplayed:function(){i(this._root_elem,"initialstate")},_track_art_url:function(t,e){var i=null;null!=t&&(i=(n=this._playerdata.tracks[t])&&n.art_id);if(!i){var n=this._playlist.get_track();i=this._playerdata.album_art_id||this._playerdata.tracks[n].art_id}var a=function(t,e){for(var i=[],n=0;n<TemplGlobals.image_formats.length;n++){var a=TemplGlobals.image_formats[n];"thumb"==a.resize_algo&&a.height==a.width&&(e&&a.anim_ok||!e&&!a.anim_ok)&&i.push(a)}i.sort((function(t,e){return t.width-e.width})),e&&(t*=2);for(n=0;n<i.length;n++)if(i[n].width>=t)return i[n].name;return i[i.length-1].name}(e,this._params.anim_ok);return ImageUtils.artURL(i,a)}};var e=function(t,e){$(t).addClass(e)},i=function(t,e){$(t).removeClass(e)},n=["prev","next","play","art","artarea","artlink","artist","trackname","tracknamelink","album","maintext","maintextlink","subtext","subtextlink","logoalt","logoalt2","currenttitle","currenttime","totaltime","timeline","linkarea","linkareaalt","tracklist","tinyplayer","progbar_thumb","progbar_fill","progbar_fill_played","currenttitle_tracknum","currenttitle_title","buyordownload","buyordownloadalt","buyordownloadlink","buyordownloadlinkalt","share","sharealt","sharelink","sharelinkalt","infolink","player","tracklist_ul","merch","infolayer"];return t.init=function(t,e,i){Sound.whenloaded((function(n){if(t&&n.success){var a=new Sound.SoundPlayer,r=!!i.album?"embedded album player":"embedded track player",s=null;i.esig&&(s={esig:i.esig,tracks:i.tracks,album:i.album,track:i.track,url_referrer:i.url_referrer});var o=new Player.Playlist(a,r,e,{url_params:s});o._trackstate=!1;for(var l=0;l<t.tracks.length;l++){var u=o.add_track(t.tracks[l]);i.t||t.tracks[l].id!==t.featured_track_id||o.set_initial_track(u)}if(i.extratracks)for(l=t.tracks.length;l<20;l++)o.add_track(t.tracks[l%t.tracks.length]);new HTMLEmbeddedPlayer3(o,i,t);if(o.init_complete(i.t),i.twittercard){var c="width=device-width,height="+470*$("#player").width()/350;$("#viewportmeta").attr("content",c)}else i["facebook.com"]&&o.play()}else t?document.getElementById("badbrowsererror").style.visibility="visible":document.getElementById("badtralbumerror").style.visibility="visible"}))},t}();!function(){"use strict";var t=document.currentScript.dataset;if(window.Browser=JSON.parse(t.browser),window.siteroot_current=JSON.parse(t.siterootCurrent),window.TemplGlobals=JSON.parse(t.templGlobals),JSON.parse(t.useScript)){var e=JSON.parse(t.parentPage),i=JSON.parse(t.playerData||"null"),n=JSON.parse(t.params||"{}");if(JSON.parse(t.initHep3||"false"))return Log.debug("initing HTMLEmbeddedPlayer3: "+t.initHep3),void document.addEventListener("DOMContentLoaded",(function(){HTMLEmbeddedPlayer3.init(i,e,n)}));var a=JSON.parse(t.playerErrors||"null"),r=null,s=null,o=!!n.album;document.addEventListener("DOMContentLoaded",(function(){Sound.whenloaded((function(t){if(i&&t.success){s=new Sound.SoundPlayer;var l=o?"embedded album player":"embedded track player";(r=new Player.Playlist(s,l,e,{url_params:n}))._trackstate=!1;for(var u=0;u<i.tracks.length;u++){var c=r.add_track(i.tracks[u]);n.t||i.tracks[u].id!==i.featured_track_id||r.set_initial_track(c)}if(n.extratracks)for(u=i.tracks.length;u<20;u++)r.add_track(i.tracks[u%i.tracks.length]);if(new HTMLEmbeddedPlayer3(r,n,i),r.init_complete(),n.twittercard){var h="width=device-width,height="+470*$("#player").width()/350;$("#viewportmeta").attr("content",h)}}else i?(document.getElementById("player").style.display="block",document.getElementById("badbrowsererror").style.visibility="visible"):(document.getElementById("player").style.display="block",a&&a.tralbum_permissions_error?(document.getElementById("tralbumpermissionserror").style.visibility="visible",$("#tralbumpermissionserror .hostname").text(a.tralbum_permissions_error)):a&&a.tralbum_wordpress_permissions_error?(document.getElementById("tralbumwordpresspermissionserror").style.visibility="visible",$("#tralbumwordpresspermissionserror .hostname").text(a.tralbum_wordpress_permissions_error)):document.getElementById("badtralbumerror").style.visibility="visible")}))}))}}();var Player={};Player.TrackInfo=function(){function t(t){this.update(t)}t.prototype={update:function(t){for(var i=e,n=0;n<i.length;n++)this[i[n]]=t[i[n]];return this},is_playable:function(){return!!this.file},is_busy:function(){return this.encoding_pending&&!this.encoding_error},mark_as_capped:function(){this.is_capped=!0},copy:function(){for(var t={},i=e,n=0;n<i.length;n++)t[i[n]]=this[i[n]];return t}},t.is_same=function(t,i){for(var n=e,a=0;a<n.length;a++)if(t[n[a]]!=i[n[a]])return!1;return!0};var e=["tracknum","file","encoding_error","encoding_pending","title","title_link","id","track_license_id","has_lyrics","has_info","is_downloadable","free_album_download","has_free_download","duration","private","album_private","artist","album_preorder","unreleased_track","alt_link","continuous","video_source_type","video_caption","video_id","video_mobile_url","is_capped"];return t}(),Player.Playlist=function(){function t(e,i,n,a){a=a||{},this._options=a,this._player=e,this._playlist=[],this._playing_from=i,a.url_params&&a.url_params.esig&&(a.url_params.album||a.url_params.track)&&(n+="&esig="+a.url_params.esig+"&rsig="+a.url_params.rsig+(a.url_params.album?"&album="+a.url_params.album:"&track="+a.url_params.track),this._url_referrer=a.url_params.url_referrer),this._referer=n,this._track=0,this._loadedtrack=-1,this._loadpercent=0,this._duration=null,this._state="IDLE",this._unloaded=!0,this._scrubbed=!1,this._trackstate=!a.no_trackstate,this._trackchanged=EventSender.create(this,"trackchanged"),this._trackplayed=EventSender.create(this,"trackplayed"),this._trackcapped=EventSender.create(this,"trackcapped"),this._scrubbedback=EventSender.create(this,"scrubbedback"),this._completedplay=EventSender.create(this,"completedplay"),this._playlistchanged=EventSender.create(this,"playlistchanged"),this._statechanged=EventSender.create(this,"statechanged"),this._loaded=EventSender.create(this,"loaded"),this._timechanged=EventSender.create(this,"time"),this.first_playable_track=-1,this.last_playable_track=-1,this._ui_listeners=new Object,this._usecomm=!0;var r=$("#pagedata").data("blob")||{};this._stream_buffer_duration_stats=r.cfg&&r.cfg.stream_buffer_duration_stats||null,this._buffering_start_time=null;var s=this;this._player.onstate((function(t,e){s._unloaded||s._handle_state({oldstate:s._state,newstate:e.newstate})})),this._player.ontime((function(t,e){s._unloaded||s._handle_time(e)})),this._player.onloaded((function(t,e){s._unloaded||s._handle_load(e)})),t.coordinator||(t.coordinator=new Player.PlaylistCoordinator),t.coordinator.add(this)}t.prototype={getoption:function(t){return this._options[t]},add_track:function(t){t=new Player.TrackInfo(t);if(this._url_referrer&&t.file)for(var e in t.file)t.file[e]+="&urlref="+document.URL.replace(/\&/g,"/");var i=this._playlist.push(t)-1;return this._playlist[i].tracknum=i,t.is_playable()&&(-1==this.first_playable_track&&(this.first_playable_track=i,this._track=i),this.last_playable_track=i),this._playlistchanged(),i},set_initial_track:function(t){this._playlist[t]&&this._playlist[t].is_playable()&&(this._track=t)},update_trackinfo:function(t,e){if(e.tracknum=t,e=this._playlist[t].update(e),this._loadedtrack=-1,e.is_playable())(-1==this.first_playable_track||t<this.first_playable_track)&&(this.first_playable_track=t),(-1==this.last_playable_track||t>this.last_playable_track)&&(this.last_playable_track=t);else{if(t==this.first_playable_track){this.first_playable_track=-1;for(var i=t+1;i<this._playlist.length;i++)if(this._playlist[i].is_playable()){this.first_playable_track=i;break}}if(t==this.last_playable_track){this.last_playable_track=-1;for(i=t-1;i>=0;i--)if(this._playlist[i].is_playable()){this.last_playable_track=i;break}}}this._playlistchanged(),"BUSY"==this._state&&e.is_playable()&&this.play()},playpause:function(){var t=null;switch(this._state){case"IDLE":case"COMPLETED":case"PAUSED":this.play(),t=1;break;case"PLAYING":case"BUFFERING":this._player.pause(),this._comm_stop(),t=-1;break;case"BUSY":this._player.stop(),this._comm_stop(),this._handle_state({newstate:"IDLE",oldstate:this._state}),t=0}return t},play:function(){var t=this._playlist[this._track];if(t&&t.is_capped)return this._reset(),void this._trackcapped(t.id);switch(this._state){case"IDLE":case"COMPLETED":case"BUSY":if(Log.debug("playlist loading track "+this._track),!t)break;for(;!t.is_playable()&&this._track<this.last_playable_track;)this._track++,t=this._playlist[this._track];if(!t.is_playable()&&1==this._playlist.length&&t.encoding_pending)this._handle_state({newstate:"BUSY",oldstate:this._state});else if(this._playlist[this._track].file&&(this._load(),this._player.play(),this._usecomm))try{this._comm_start(),this._stop_other_players()}catch(t){}break;case"PAUSED":case"BUFFERING":if(this._player.play(),this._usecomm)try{this._comm_start(),this._stop_other_players()}catch(t){}}var e=this._track;this._trackplayed(e)},pause:function(){switch(this._state){case"PLAYING":case"BUFFERING":this._player.pause(),this._comm_stop();break;case"BUSY":this._player.stop(),this._comm_stop(),this._handle_state({newstate:"IDLE",oldstate:this._state})}},stop:function(){this._player.stop(),this._handle_state({newstate:"IDLE",oldstate:this._state})},seek:function(t){if(this._unloaded=!1,(e=this._playlist[this._track])&&e.is_capped)return this._reset(),void this._trackcapped(e.id);if(t<=2&&null==this._playstat){var e;if((e=this._playlist[this._track])&&e.is_capped)return this._reset(),void this._trackcapped(e.id);e&&this._scrubbedback(e.id),this._scrubbed=!0}this._player.seek(t)},play_track:function(t,e){var i=this.get_track_info(t);if(i&&i.is_capped)return this._reset(),void this._trackcapped(i.id);this._loadedtrack!=t&&(this._state="IDLE",this._player.stop(),this._track=t,this._load()),this._unloaded=!1,null!=e?this.seek(e):this.play()},percent_loaded:function(){return this._loadpercent||0},position:function(){return this._position},duration:function(){if(null!=this._duration)return this._duration;var t=this.get_track_info();return t?t.duration:0},init_complete:function(t){this._trackstate&&this._loadstate()||(t||this._track>0)&&this._trackchanged(this._playlist[this._track])},register_listener:function(t,e){var i=this._ui_listeners[t];i?($assert($.isArray(i),"expected array of event listeners"),i.push(e)):((i=new Array).push(e),this._ui_listeners[t]=i)},player:function(){return this._player},unload:function(){this.stop(),this._unloaded=!0,this._playlist=[],this._track=0,this._loadedtrack=-1,this._loadpercent=0,this._position=0,this.first_playable_track=-1,this.last_playable_track=-1,this._playlistchanged(),this._handle_state({newstate:"IDLE",oldstate:this._state})},load:function(t){this.unload();for(var e=0;e<t.length;e++)this.add_track(t[e])},_reset:function(){this.stop(),this._track=this.first_playable_track,this._trackchanged(this._playlist[this._track]),this._loadedtrack=-1},_handle_state:function(t){if(this._state!=t.newstate){if("PLAYING"!=t.newstate&&"BUFFERING"!=t.newstate&&("PAUSED"!=t.newstate&&(this._position=0),this._clearstate()),this._state=t.newstate,"COMPLETED"!=t.newstate||"PLAYING"!=t.oldstate&&"BUFFERING"!=t.oldstate&&"PAUSED"!=t.oldstate)this._statechanged(t);else if(!this.seeking)if(this._track+1<=this.last_playable_track){this._state="IDLE",this._player.stop();var e=this.get_track_info();e&&0==e.continuous?this._statechanged(t):this.next_track()}else this._track=0,this._loadedtrack=-1,this._statechanged(t),this._trackchanged(this._playlist[this.first_playable_track]);1==this._stream_buffer_duration_stats&&("BUFFERING"!=t.newstate||"IDLE"!=t.oldstate&&"COMPLETED"!=t.oldstate?null!=this._buffering_start_time&&"PLAYING"==t.newstate&&(buffering_duration=Date.now()-this._buffering_start_time,this._buffering_start_time=null,this._playstat&&this._playstat.report_stream_buffer_duration(buffering_duration,this._options.hq)):this._buffering_start_time=Date.now()),"PAUSED"==t.newstate&&this._playstat&&this._playstat.report_stream_end(this._position)}},_handle_load:function(t){0==t.total?this._loadpercent=0:this._loadpercent=100*t.loaded/t.total,this._loaded(this._loadpercent)},_handle_time:function(t){this._trackstate&&this._savestate(t.position),this._position=t.position,this._duration=t.duration,this._timechanged(t);var e=this._playlist[this._track];this._playstat&&t.duration>0&&(this._playstat.play_progress(t.position,t.duration)||(this._playstat=null,e&&"undefined"!=e&&this._completedplay(e.id))),Player.PlayStat.is_complete(t.position,t.duration)&&this._scrubbed&&(this._scrubbed=!1,e&&"undefined"!=e&&this._completedplay(e.id,!0))},prev_track:function(){var t=this._track;do{t--}while(t>=0&&!this._playlist[t].file);-1==t&&(t=0),this._track=t,this._isplaying()&&(this._state="IDLE",this._player.stop()),this.play()},next_track:function(){var t=this._track;do{t++}while(t<this._playlist.length&&!this._playlist[t].file);t==this._playlist.length&&(t=0),this._track=t,this._isplaying()&&(this._state="IDLE",this._player.stop()),this.play()},get_state:function(){return this._state},get_track:function(){return this._track},get_track_info:function(t){return 0==this._playlist.length?null:void 0!==t?this._playlist[t].copy():this._playlist[this._track].copy()},cap_playback_for_track:function(t){for(var e=0;this._playlist&&e<this._playlist.length;e++){var i=this._playlist[e];if(i.id==t){i.mark_as_capped();break}}},length:function(){return this._playlist.length},_notify_listeners:function(t,e){var i=this._ui_listeners[t];if(i)for(var n=i.length-1;n>=0;n--)i[n](e)},_load:function(){if(this._loadedtrack!=this._track){this._loadedtrack=this._track,this._unloaded=!1,this._player.load(this._playlist[this._track].file,this._options.hq),this._loadpercent=0;var t=this._playlist[this._track];this._trackchanged(t),this._playstat=new Player.PlayStat(t,this._playing_from,this._referer),this._scrubbed=!1}else this.seek(0)},_isplaying:function(){return"PLAYING"==this._state||"PAUSED"==this._state||"BUFFERING"==this._state},_managestate:"iphone"!=Browser.platform,_loadstate:function(){if(!this._managestate)return!1;Log.debug("reading/clearing playlist state");var t=!1;try{var i=Cookie.get(e);if(Cookie.clear(e),i=JSON.parse(i))for(var n=0;n<this._playlist.length;n++)if(this._playlist[n].id==i.track_id){Log.debug("found player state, playing track "+n+" at pos "+i.pos),this.play_track(n,i.pos),t=!0;break}}catch(t){}return t},_clearstate:function(){if(this._managestate)try{Cookie.clear(e)}catch(t){}},_savestate:function(t){if(this._managestate&&("PLAYING"==this._state||"BUFFERING"==this._state)){var a=this._playlist[this._track].id;if(Math.abs(this._saved_pos-t)>n||a!=this._saved_track_id){this._saved_track_id=a,this._saved_pos=t;var r={track_id:a,pos:t};try{var s=JSON.stringify(r);Cookie.set(e,s,i)}catch(t){}}}},_comm_start:function(){this._comm||(this._comm=new Cookie.CommChannel("playlist"),this._comm.subscribe($.proxy(this._comm_recv,this))),this._comm.startListening()},_comm_stop:function(){this._comm&&this._comm.stopListening()},_comm_recv:function(t,e){switch(e[1]){case"stop":Log.debug("received cookie comm stop command.  stopping."),this.stop()}},_stop_other_players:function(){this._comm.send("stop")}};var e="playlist_state",i=30,n=1;return t.PLAY_TRACK="play_track",t}(),Player.PlaylistCoordinator=function(){function t(){this._playlists=[],this._playingcount=0,this._playing=EventSender.create(this,"playing"),this._stopped=EventSender.create(this,"stopped")}return t.prototype.add=function(t){var e=this;t.onstatechanged((function(i){e._handle_playlist_statechanged(t,i)})),this.onplaying((function(e){t!=e&&(t.getoption("savepos")?t.pause():t.stop())}))},t.prototype._handle_playlist_statechanged=function(t,e){var i="PLAYING"==e.newstate||"BUFFERING"==e.newstate,n="PLAYING"==e.oldstate||"BUFFERING"==e.oldstate;i&&!n?this._playingcount++:n&&!i&&(this._playingcount--,0==this._playingcount&&this._stopped()),i&&this._playing(t)},t}(),Player.PlayStat=function(){function t(t,i,n){params={kind:"track play",track_id:t.id,track_license_id:t.track_license_id,from:i,from_url:n||location.toString(),stream_duration:null},e.call(this,params,"started")}var e=Stats.PhasedStat;for(var i in Stats.PhasedStat.prototype)t.prototype[i]=Stats.PhasedStat.prototype[i];return t.prototype.play_progress=function(e,i){var n=t.is_partial(e,i),a=t.is_past_30(e,i),r=t.is_complete(e,i);return!this._partial_sent&&n&&(this._partial_sent=!0,this.change_phase("partial")),!this._30_seconds_sent&&a&&(this._30_seconds_sent=!0,this.change_phase("thirty")),!(!this._complete_sent&&r)||(this._complete_sent=!0,this._params.stream_duration=i,this.change_phase("complete"),!1)},t.is_partial=function(t,e){var i=!1;return t&&e&&(partial=10*e/100,i=t>partial),i},t.is_past_30=function(t){var e=!1;return t&&(e=t>30),e},t.is_complete=function(t,e){var i=!1;return t&&e&&(complete=90*e/100,i=t>complete),i},t.prototype.report_stream_end=function(t){t>30&&this._params.stream_duration<t&&(this._params.stream_duration=t,this.change_phase("stream_end"))},t.prototype.report_stream_buffer_duration=function(t,e){return Stats.record({kind:"stream buffer duration",duration_ms:t,is_hq:e}),!0},t}();var FacebookUtils={_sdkLoadPromise:null,initSDK:function(){if(FacebookUtils._sdkLoadPromise)return FacebookUtils._sdkLoadPromise;var t,e=new $.Deferred;return window.fbAsyncInit=function(){Log.debug("Facebook SDK loaded"),FB.init({appId:"165661066782720",status:!0,cookie:!0,xfbml:!1}),e.resolve()},$(document.body).prepend('<div id="fb-root"></div>'),fbLocales={en:"en_US",fr:"fr_FR",ja:"ja_JP",qq:"ja_JP"},"Translate"in window&&"locale"in Translate&&(t=fbLocales[Translate.locale]),t||(t="en_US",Log.server("Facebook SDK couldn't determine FB locale","error")),$.cachedScript("//connect.facebook.net/"+t+"/all.js"),FacebookUtils._sdkLoadPromise=e.promise()},xxx:null},EmailIMUtils={alreadyStattedFromFocus:!1,onFocus:function(){return self.alreadyStattedFromFocus||(Stats.record({kind:"click",click:"email_tralbum"}),self.alreadyStattedFromFocus=!0),!1},xxx:null},SocialControls={initFromDOM:function(t){var e=this,i=$(t);i.add(".social-controls",i).filter(".social-controls").each((function(){var t=$(this);e._initControlsOfType(t.find(".facebook-like-ctrl"),"renderFacebookLike"),e._initControlsOfType(t.find(".facebook-share-ctrl"),"renderFacebookShare"),e._initControlsOfType(t.find(".facebook-share-dlg-ctrl"),"renderFacebookDialogShare"),e._initControlsOfType(t.find(".twitter-ctrl"),"renderTwitterShare"),e._initControlsOfType(t.find(".reddit-ctrl"),"renderRedditShare"),e._initControlsOfType(t.find(".tumblr-ctrl"),"renderTumblrShare"),e._initControlsOfType(t.find(".email-ctrl"),"renderEmailShare")}))},renderFacebookLike:function(t,e){var i=this,n=$(t),a={url:location.href,send:"false",layout:"button_count",width:"90","show-faces":"false"},r=(e=$.extend(a,e),$('<div class="fb-like"></div>').appendTo(n));$.each(e,(function(t,e){"url"==t&&(t="href"),r.attr("data-"+t,e)})),FacebookUtils.initSDK().done((function(){FB.XFBML.parse(n[0]),i._registerFBEventHandlers(t,e),n.data("scResolvedData",e)}))},renderFacebookDialogShare:function(t,e){!function(t,e,i){var n=t.getElementsByTagName(e)[0],a=t.createElement(e);a.id="facebook-jssdk",a.src="https://connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(a,n)}(document,"script"),window.fbAsyncInit=function(){FB.init({appId:e.appId,autoLogAppEvents:!0,xfbml:!0,version:"v3.2"})},$(t).find(".facebook-link").first().click((function(t){FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":e.url,"og:title":e.title,"og:description":e.text,"og:image":e.image,"og:image:width":100,"og:image:height":100}})},(function(t){}))}))},renderFacebookShare:function(t,e){var i=this,n=$(t),a={url:location.href},r={u:(e=$.extend(a,e)).url},s=!window.MediaView||"desktop"==MediaView.mode,o=Url.addQueryParams(s?"http://www.facebook.com/sharer.php":"http://m.facebook.com/sharer.php",r),l=n.find(".facebook-link").first();l.length||(l=$('<a class="facebook-link" title="Share on Facebook">Share</a>').appendTo(n)),l.attr({href:o,target:"_blank"}).click((function(t){i._statClick(e,"on"),s&&(window.open(o,"share_fb","toolbar=0,status=0,width=626,height=436"),t.preventDefault())}))},renderTwitterShare:function(t,e){var i=this,n=$(t),a={url:location.href},r={url:(e=$.extend(a,e)).url},s=!window.MediaView||"phone"!=MediaView.mode;e.text&&(r.text=e.text);var o,l,u=Url.addQueryParams("https://twitter.com/intent/tweet",r),c=n.find(".twitter-link").first();c.length||("undefined"==typeof TM?(o="Tweet",l="Share on Twitter"):(o=TM("Tweet"),l=TM("Share on Twitter")),c=$('<a class="twitter-link" title="'+l+'">'+o+"</a>").appendTo(n));c.attr({href:u,target:"_blank"}).click((function(t){i._statClick(e,"on"),s&&(window.open(u,"share_tw","toolbar=0,status=0,width=550,height=450"),t.preventDefault())}))},renderRedditShare:function(t,e){var i=this,n=$(t),a={url:location.href},r={url:(e=$.extend(a,e)).url,title:e.title,kind:"self"},s=!window.MediaView||"phone"!=MediaView.mode,o=Url.addQueryParams("https://www.reddit.com/submit",r),l=n.find(".reddit-link").first();if(!l.length){var u=TM("Reddit"),c=TM("Share on Reddit");l=$('<a class="reddit-link" title="'+c+'">'+u+"</a>").appendTo(n)}l.attr({href:o,target:"_blank"}).click((function(t){i._statClick(e,"on"),s&&(window.open(o,"share_rd","toolbar=0,status=0,width=550,height=450"),t.preventDefault())}))},renderTumblrShare:function(t,e){var i=this,n=$(t),a={url:location.href,type:"link"},r={};"audio"==(e=$.extend(a,e)).type?(r.external_url=e.url,e.text&&(r.caption=e.text)):(r.url=e.url,e.title&&(r.name=e.title),e.text&&(r.description=e.text));var s=Url.addQueryParams("http://www.tumblr.com/share/"+e.type,r),o=n.find(".tumblr-link").first();o.length||(o=$('<a class="tumblr-link" title="Share on Tumblr">Share on Tumblr</a>').appendTo(n)),o.attr({href:s,target:"_blank"}).click((function(t){i._statClick(e,"on")}))},renderEmailShare:function(t,e){var i=this,n=$(t),a={url:location.href},r={body:(e=$.extend(a,e)).url};e.text&&(r.body=e.text+"\r\n\r\n"+r.body),e.subject&&(r.subject=e.subject);var s="mailto:?"+Url.joinQuery(r),o=n.find(".email-link").first();o.length||(o=$('<a class="email-link" title="Share via email">Email</a>').appendTo(n)),o.attr({href:s}).click((function(t){return i._statClick(e,"on"),setTimeout((function(){location.href=s}),100),!1}))},_initControlsOfType:function(t,e){var i=this;$(t).each((function(){i[e](this,i._getData(this))}))},_getData:function(t,e){var i=$(t),n=i.data(),a=i.closest(".social-controls").data();return $.extend(e||{},a,n)},_statClick:function(t,e){var i=null;"on"==e?i=t.stat||t.statOn:"off"==e&&(i=t.statOff),i&&Stats.record({kind:"click",click:i})},_initedFBEvents:!1,_registerFBEventHandlers:function(){var t=this;this._initedFBEvents||(FacebookUtils.initSDK().done((function(){FB.Event.subscribe("edge.create",$.proxy(t,"_handleFBEvent","on")),FB.Event.subscribe("edge.remove",$.proxy(t,"_handleFBEvent","off"))})),this._initedFBEvents=!0)},_handleFBEvent:function(t,e,i){if(i&&i.dom&&i.dom.tagName){var n=$(i.dom).closest(".facebook-like-ctrl").data("scResolvedData");n&&e==n.url&&this._statClick(n,t)}else Log.error("SocialControls: can't stat FB Like/Unlike because event parameter 'widget' is missing or has changed")},xxx:null};!function(t,e){t.widget("ui.draggable",t.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).is(".ui-resizable-handle"))&&(this.handle=this._getHandle(e),!!this.handle&&(t(!0===i.iframeFix?"iframe":i.iframeFix).each((function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")})),!0))},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(!1===this._trigger("drag",e,n))return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=!1;t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],a=!1;n&&(n=n.parentNode);)n==document&&(a=!0);if(!a&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==r._trigger("stop",e)&&r._clear()}))}else!1!==this._trigger("stop",e)&&this._clear();return!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each((function(){this.parentNode.removeChild(this)})),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var i=!this.options.handle||!t(this.options.handle,this.element).length;return t(this.options.handle,this.element).find("*").andSelf().each((function(){this==e.target&&(i=!0)})),i},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]!=this.element[0]&&!/(fixed|absolute)/.test(n.css("position"))&&n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),"document"!=e.containment&&"window"!=e.containment||(this.containment=["document"==e.containment?0:t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==e.containment?0:t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{var i=t(e.containment),n=i[0];if(!n)return;i.offset();var a="hidden"!=t(n).css("overflow");this.containment=[(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0),(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0),(a?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"==e?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*n}},_generatePosition:function(e){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName),r=e.pageX,s=e.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;e.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),e.pageY-this.offset.click.top<o[1]&&(s=o[1]+this.offset.click.top),e.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),e.pageY-this.offset.click.top>o[3]&&(s=o[3]+this.offset.click.top)}if(i.grid){var u=i.grid[1]?this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;s=o&&(u-this.offset.click.top<o[1]||u-this.offset.click.top>o[3])?u-this.offset.click.top<o[1]?u+i.grid[1]:u-i.grid[1]:u;var c=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o&&(c-this.offset.click.left<o[0]||c-this.offset.click.left>o[2])?c-this.offset.click.left<o[0]?c+i.grid[0]:c-i.grid[0]:c}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(t){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var n=t(this).data("draggable"),a=n.options,r=t.extend({},i,{item:n.element});n.sortables=[],t(a.connectToSortable).each((function(){var i=t.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,r))}))},stop:function(e,i){var n=t(this).data("draggable"),a=t.extend({},i,{item:n.element});t.each(n.sortables,(function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,a))}))},drag:function(e,i){var n=t(this).data("draggable"),a=this;t.each(n.sortables,(function(r){var s=!1,o=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,t.each(n.sortables,(function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!=o&&this.instance._intersectsWith(this.instance.containerCache)&&t.ui.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s}))),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(a).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)}))}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i){var n=t("body"),a=t(this).data("draggable").options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(e,i){var n=t(this).data("draggable").options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var n=t(i.helper),a=t(this).data("draggable").options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(e,i){var n=t(this).data("draggable").options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(e,i){var n=t(this).data("draggable");n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName&&(n.overflowOffset=n.scrollParent.offset())},drag:function(e,i){var n=t(this).data("draggable"),a=n.options,r=!1;n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName?(a.axis&&"x"==a.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-n.overflowOffset.top<a.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-a.scrollSpeed)),a.axis&&"y"==a.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-n.overflowOffset.left<a.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-a.scrollSpeed))):(a.axis&&"x"==a.axis||(e.pageY-t(document).scrollTop()<a.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed))),a.axis&&"y"==a.axis||(e.pageX-t(document).scrollLeft()<a.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed)))),!1!==r&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i){var n=t(this).data("draggable"),a=n.options;n.snapElements=[],t(a.snap.constructor!=String?a.snap.items||":data(draggable)":a.snap).each((function(){var e=t(this),i=e.offset();this!=n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})}))},drag:function(e,i){for(var n=t(this).data("draggable"),a=n.options,r=a.snapTolerance,s=i.offset.left,o=s+n.helperProportions.width,l=i.offset.top,u=l+n.helperProportions.height,c=n.snapElements.length-1;c>=0;c--){var h=n.snapElements[c].left,d=h+n.snapElements[c].width,p=n.snapElements[c].top,_=p+n.snapElements[c].height;if(h-r<s&&s<d+r&&p-r<l&&l<_+r||h-r<s&&s<d+r&&p-r<u&&u<_+r||h-r<o&&o<d+r&&p-r<l&&l<_+r||h-r<o&&o<d+r&&p-r<u&&u<_+r){if("inner"!=a.snapMode){var m=Math.abs(p-u)<=r,f=Math.abs(_-l)<=r,g=Math.abs(h-o)<=r,y=Math.abs(d-s)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),f&&(i.position.top=n._convertPositionTo("relative",{top:_,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left)}var v=m||f||g||y;if("outer"!=a.snapMode){m=Math.abs(p-l)<=r,f=Math.abs(_-u)<=r,g=Math.abs(h-s)<=r,y=Math.abs(d-o)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),f&&(i.position.top=n._convertPositionTo("relative",{top:_-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[c].snapping&&(m||f||g||y||v)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=m||f||g||y||v}else n.snapElements[c].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(e,i){var n=t(this).data("draggable").options,a=t.makeArray(t(n.stack)).sort((function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)}));if(a.length){var r=parseInt(a[0].style.zIndex)||0;t(a).each((function(t){this.style.zIndex=r+t})),this[0].style.zIndex=r+a.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var n=t(i.helper),a=t(this).data("draggable").options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(e,i){var n=t(this).data("draggable").options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(t,e){var i="ui-dialog ui-widget ui-widget-content ui-corner-all ",n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},a={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;i<0&&t(this).css("top",e.top-i)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),"string"!=typeof this.originalTitle&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var e,n,a,r,s,o=this,l=this.options,u=l.title||"&#160;";e=(this.uiDialog=t("<div>")).addClass(i+l.dialogClass).css({display:"none",outline:0,zIndex:l.zIndex}).attr("tabIndex",-1).keydown((function(e){l.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE&&(o.close(e),e.preventDefault())})).mousedown((function(t){o.moveToTop(!1,t)})).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(e),n=(this.uiDialogTitlebar=t("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",(function(){e.focus()})).prependTo(e),a=t("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click((function(t){t.preventDefault(),o.close(t)})).appendTo(n),(this.uiDialogTitlebarCloseText=t("<span>")).addClass("ui-icon ui-icon-closethick").text(l.closeText).appendTo(a),r=t("<span>").uniqueId().addClass("ui-dialog-title").html(u).prependTo(n),s=(this.uiDialogButtonPane=t("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=t("<div>")).addClass("ui-dialog-buttonset").appendTo(s),e.attr({role:"dialog","aria-labelledby":r.attr("id")}),n.find("*").add(n).disableSelection(),this._hoverable(a),this._focusable(a),l.draggable&&t.fn.draggable&&this._makeDraggable(),l.resizable&&t.fn.resizable&&this._makeResizable(),this._createButtons(l.buttons),this._isOpen=!1,t.fn.bgiframe&&e.bgiframe(),this._on(e,{keydown:function(i){if(l.modal&&i.keyCode===t.ui.keyCode.TAB){var n=t(":tabbable",e),a=n.filter(":first"),r=n.filter(":last");return i.target!==r[0]||i.shiftKey?i.target===a[0]&&i.shiftKey?(r.focus(1),!1):void 0:(a.focus(1),!1)}}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var t,e=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(e){var i,n,a=this;if(this._isOpen&&!1!==this._trigger("beforeClose",e))return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,(function(){a._trigger("close",e)})):(this.uiDialog.hide(),this._trigger("close",e)),t.ui.dialog.overlay.resize(),this.options.modal&&(i=0,t(".ui-dialog").each((function(){this!==a.uiDialog[0]&&(n=t(this).css("z-index"),isNaN(n)||(i=Math.max(i,n)))})),t.ui.dialog.maxZ=i),this},isOpen:function(){return this._isOpen},moveToTop:function(e,i){var n,a=this.options;return a.modal&&!e||!a.stack&&!a.modal?this._trigger("focus",i):(a.zIndex>t.ui.dialog.maxZ&&(t.ui.dialog.maxZ=a.zIndex),this.overlay&&(t.ui.dialog.maxZ+=1,t.ui.dialog.overlay.maxZ=t.ui.dialog.maxZ,this.overlay.$el.css("z-index",t.ui.dialog.overlay.maxZ)),n={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},t.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",t.ui.dialog.maxZ),this.element.attr(n),this._trigger("focus",i),this)},open:function(){if(!this._isOpen){var e,i=this.options,n=this.uiDialog;return this._size(),this._position(i.position),n.show(i.show),this.overlay=i.modal?new t.ui.dialog.overlay(this):null,this.moveToTop(!0),(e=this.element.find(":tabbable")).length||((e=this.uiDialogButtonPane.find(":tabbable")).length||(e=n)),e.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this}},_createButtons:function(e){var i=this,n=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),"object"==typeof e&&null!==e&&t.each(e,(function(){return!(n=!0)})),n?(t.each(e,(function(e,n){var a,r;n=t.isFunction(n)?{click:n,text:e}:n,n=t.extend({type:"button"},n),r=n.click,n.click=function(){r.apply(i.element[0],arguments)},a=t("<button></button>",n).appendTo(i.uiButtonSet),t.fn.button&&a.button()})),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,a){t(this).addClass("ui-dialog-dragging"),i._trigger("dragStart",n,e(a))},drag:function(t,n){i._trigger("drag",t,e(n))},stop:function(a,r){n.position=[r.position.left-i.document.scrollLeft(),r.position.top-i.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),i._trigger("dragStop",a,e(r)),t.ui.dialog.overlay.resize()}})},_makeResizable:function(e){function i(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}e=undefined===e?this.options.resizable:e;var n=this,a=this.options,r=this.uiDialog.css("position"),s="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minWidth:a.minWidth,minHeight:this._minHeight(),handles:s,start:function(e,a){t(this).addClass("ui-dialog-resizing"),n._trigger("resizeStart",e,i(a))},resize:function(t,e){n._trigger("resize",t,i(e))},stop:function(e,r){t(this).removeClass("ui-dialog-resizing"),a.height=t(this).height(),a.width=t(this).width(),n._trigger("resizeStop",e,i(r)),t.ui.dialog.overlay.resize()}}).css("position",r).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(e){var i,n=[],a=[0,0];e?(("string"==typeof e||"object"==typeof e&&"0"in e)&&(1===(n=e.split?e.split(" "):[e[0],e[1]]).length&&(n[1]=n[0]),t.each(["left","top"],(function(t,e){+n[t]===n[t]&&(a[t]=n[t],n[t]=e)})),e={my:n[0]+(a[0]<0?a[0]:"+"+a[0])+" "+n[1]+(a[1]<0?a[1]:"+"+a[1]),at:n.join(" ")}),e=t.extend({},t.ui.dialog.prototype.options.position,e)):e=t.ui.dialog.prototype.options.position,(i=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.position(e),i||this.uiDialog.hide()},_setOptions:function(e){var i=this,r={},s=!1;t.each(e,(function(t,e){i._setOption(t,e),t in n&&(s=!0),t in a&&(r[t]=e)})),s&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(e,n){var a,r,s=this.uiDialog;switch(e){case"buttons":this._createButtons(n);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":s.removeClass(this.options.dialogClass).addClass(i+n);break;case"disabled":n?s.addClass("ui-dialog-disabled"):s.removeClass("ui-dialog-disabled");break;case"draggable":(a=s.is(":data(draggable)"))&&!n&&s.draggable("destroy"),!a&&n&&this._makeDraggable();break;case"position":this._position(n);break;case"resizable":(r=s.is(":data(resizable)"))&&!n&&s.resizable("destroy"),r&&"string"==typeof n&&s.resizable("option","handles",n),!r&&!1!==n&&this._makeResizable(n);break;case"title":t(".ui-dialog-title",this.uiDialogTitlebar).html(""+(n||"&#160;"))}this._super(e,n)},_size:function(){var e,i,n,a=this.options,r=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),a.minWidth>a.width&&(a.width=a.minWidth),e=this.uiDialog.css({height:"auto",width:a.width}).outerHeight(),i=Math.max(0,a.minHeight-e),"auto"===a.height?t.support.minHeight?this.element.css({minHeight:i,height:"auto"}):(this.uiDialog.show(),n=this.element.css("height","auto").height(),r||this.uiDialog.hide(),this.element.height(Math.max(n,i))):this.element.height(Math.max(a.height-e,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),t.extend(t.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(t){var e=t.attr("id");return e||(this.uuid+=1,e=this.uuid),"ui-dialog-title-"+e},overlay:function(e){this.$el=t.ui.dialog.overlay.create(e)}}),t.extend(t.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:t.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),(function(t){return t+".dialog-overlay"})).join(" "),create:function(e){0===this.instances.length&&(setTimeout((function(){t.ui.dialog.overlay.instances.length&&t(document).bind(t.ui.dialog.overlay.events,(function(e){if(t(e.target).zIndex()<t.ui.dialog.overlay.maxZ)return!1}))}),1),t(window).bind("resize.dialog-overlay",t.ui.dialog.overlay.resize));var i=this.oldInstances.pop()||t("<div>").addClass("ui-widget-overlay");return t(document).bind("keydown.dialog-overlay",(function(n){var a=t.ui.dialog.overlay.instances;0!==a.length&&a[a.length-1]===i&&e.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===t.ui.keyCode.ESCAPE&&(e.close(n),n.preventDefault())})),i.appendTo(document.body).css({width:this.width(),height:this.height()}),t.fn.bgiframe&&i.bgiframe(),this.instances.push(i),i},destroy:function(e){var i=t.inArray(e,this.instances),n=0;-1!==i&&this.oldInstances.push(this.instances.splice(i,1)[0]),0===this.instances.length&&t([document,window]).unbind(".dialog-overlay"),e.height(0).width(0).remove(),t.each(this.instances,(function(){n=Math.max(n,this.css("z-index"))})),this.maxZ=n},height:function(){var e;return t.ui.ie?(e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight))<Math.max(document.documentElement.offsetHeight,document.body.offsetHeight)?t(window).height()+"px":e+"px":t(document).height()+"px"},width:function(){var e;return t.ui.ie?(e=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth))<Math.max(document.documentElement.offsetWidth,document.body.offsetWidth)?t(window).width()+"px":e+"px":t(document).width()+"px"},resize:function(){var e=t([]);t.each(t.ui.dialog.overlay.instances,(function(){e=e.add(this)})),e.css({width:0,height:0}).css({width:t.ui.dialog.overlay.width(),height:t.ui.dialog.overlay.height()})}}),t.extend(t.ui.dialog.overlay.prototype,{destroy:function(){t.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(){function t(t,e){var c,h=this;if(h.element="object"==typeof t?t:document.getElementById(t),h.wrapper=h.element.parentNode,h.element.style.webkitTransitionProperty="-webkit-transform",h.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)",h.element.style.webkitTransitionDuration="0",h.element.style.webkitTransform=l+"0,0"+u,h.options={bounce:i,momentum:i,checkDOMChanges:!0,topOnDOMChanges:!1,hScrollbar:i,vScrollbar:i,fadeScrollbar:n||!a,shrinkScrollbar:n||!a,desktopCompatibility:!1,overflow:"auto",snap:!1,bounceLock:!1,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}},"object"==typeof e)for(c in e)h.options[c]=e[c];h.options.desktopCompatibility&&(h.options.overflow="hidden"),h.onScrollEnd=h.options.onScrollEnd,delete h.options.onScrollEnd,h.wrapper.style.overflow=h.options.overflow,h.refresh(),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",h,!1),(a||h.options.desktopCompatibility)&&(h.element.addEventListener(r,h,!1),h.element.addEventListener(s,h,!1),h.element.addEventListener(o,h,!1)),h.options.checkDOMChanges&&h.element.addEventListener("DOMSubtreeModified",h,!1)}function e(t,e,i,n,a){var r=this,s=document;r.dir=t,r.fade=i,r.shrink=n,r.uid=++c,r.bar=s.createElement("div"),r.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+a+";-webkit-transform:"+l+"0,0"+u+";"+("horizontal"==t?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px"),r.wrapper=s.createElement("div"),r.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+r.uid+r.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(i?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+("horizontal"==r.dir?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;"),r.wrapper.appendChild(r.bar),e.appendChild(r.wrapper)}t.prototype={x:0,y:0,enabled:!0,handleEvent:function(t){var e=this;switch(t.type){case r:e.touchStart(t);break;case s:e.touchMove(t);break;case o:e.touchEnd(t);break;case"webkitTransitionEnd":e.transitionEnd();break;case"orientationchange":case"resize":e.refresh();break;case"DOMSubtreeModified":e.onDOMModified(t)}},onDOMModified:function(t){var e=this;t.target.parentNode==e.element&&(setTimeout((function(){e.refresh()}),0),!e.options.topOnDOMChanges||0==e.x&&0==e.y||e.scrollTo(0,0,"0"))},refresh:function(){var t,i=this,n=i.x,a=i.y;i.scrollWidth=i.wrapper.clientWidth,i.scrollHeight=i.wrapper.clientHeight,i.scrollerWidth=i.element.offsetWidth,i.scrollerHeight=i.element.offsetHeight,i.maxScrollX=i.scrollWidth-i.scrollerWidth,i.maxScrollY=i.scrollHeight-i.scrollerHeight,i.directionX=0,i.directionY=0,i.scrollX&&(i.maxScrollX>=0?n=0:i.x<i.maxScrollX&&(n=i.maxScrollX)),i.scrollY&&(i.maxScrollY>=0?a=0:i.y<i.maxScrollY&&(a=i.maxScrollY)),i.options.snap&&(i.maxPageX=-Math.floor(i.maxScrollX/i.scrollWidth),i.maxPageY=-Math.floor(i.maxScrollY/i.scrollHeight),n=(t=i.snap(n,a)).x,a=t.y),n==i.x&&a==i.y||(i.setTransitionTime("0"),i.setPosition(n,a,!0)),i.scrollX=i.scrollerWidth>i.scrollWidth,i.scrollY=!i.options.bounceLock&&!i.scrollX||i.scrollerHeight>i.scrollHeight,i.options.hScrollbar&&i.scrollX?(i.scrollBarX=i.scrollBarX||new e("horizontal",i.wrapper,i.options.fadeScrollbar,i.options.shrinkScrollbar,i.options.scrollbarColor),i.scrollBarX.init(i.scrollWidth,i.scrollerWidth)):i.scrollBarX&&(i.scrollBarX=i.scrollBarX.remove()),i.options.vScrollbar&&i.scrollY&&i.scrollerHeight>i.scrollHeight?(i.scrollBarY=i.scrollBarY||new e("vertical",i.wrapper,i.options.fadeScrollbar,i.options.shrinkScrollbar,i.options.scrollbarColor),i.scrollBarY.init(i.scrollHeight,i.scrollerHeight)):i.scrollBarY&&(i.scrollBarY=i.scrollBarY.remove())},setPosition:function(t,e,i){var n=this;n.x=t,n.y=e,n.element.style.webkitTransform=l+n.x+"px,"+n.y+"px"+u,i||(n.scrollBarX&&n.scrollBarX.setPosition(n.x),n.scrollBarY&&n.scrollBarY.setPosition(n.y))},setTransitionTime:function(t){var e=this;t=t||"0",e.element.style.webkitTransitionDuration=t,e.scrollBarX&&(e.scrollBarX.bar.style.webkitTransitionDuration=t,e.scrollBarX.wrapper.style.webkitTransitionDuration=i&&e.options.fadeScrollbar?"300ms":"0"),e.scrollBarY&&(e.scrollBarY.bar.style.webkitTransitionDuration=t,e.scrollBarY.wrapper.style.webkitTransitionDuration=i&&e.options.fadeScrollbar?"300ms":"0")},touchStart:function(t){var e,i=this;i.enabled&&(t.preventDefault(),t.stopPropagation(),i.scrolling=!0,i.moved=!1,i.distX=0,i.distY=0,i.setTransitionTime("0"),(i.options.momentum||i.options.snap)&&((e=new WebKitCSSMatrix(window.getComputedStyle(i.element).webkitTransform)).e==i.x&&e.f==i.y||(document.removeEventListener("webkitTransitionEnd",i,!1),i.setPosition(e.e,e.f),i.moved=!0)),i.touchStartX=a?t.changedTouches[0].pageX:t.pageX,i.scrollStartX=i.x,i.touchStartY=a?t.changedTouches[0].pageY:t.pageY,i.scrollStartY=i.y,i.scrollStartTime=t.timeStamp,i.directionX=0,i.directionY=0)},touchMove:function(t){if(this.scrolling){var e=this,i=a?t.changedTouches[0].pageX:t.pageX,n=a?t.changedTouches[0].pageY:t.pageY,r=e.scrollX?i-e.touchStartX:0,s=e.scrollY?n-e.touchStartY:0,o=e.x+r,l=e.y+s;t.stopPropagation(),e.touchStartX=i,e.touchStartY=n,(o>=0||o<e.maxScrollX)&&(o=e.options.bounce?Math.round(e.x+r/3):o>=0||e.maxScrollX>=0?0:e.maxScrollX),(l>=0||l<e.maxScrollY)&&(l=e.options.bounce?Math.round(e.y+s/3):l>=0||e.maxScrollY>=0?0:e.maxScrollY),e.distX+e.distY>5?(e.distX-3>e.distY?(l=e.y,s=0):e.distY-3>e.distX&&(o=e.x,r=0),e.setPosition(o,l),e.moved=!0,e.directionX=r>0?-1:1,e.directionY=s>0?-1:1):(e.distX+=Math.abs(r),e.distY+=Math.abs(s))}},touchEnd:function(t){if(this.scrolling){var e,i,n,r,s,o=this,l=t.timeStamp-o.scrollStartTime,u=a?t.changedTouches[0]:t,c=0,h=o.x,d=o.y;if(o.scrolling=!1,o.moved)!o.options.snap&&l>250?o.resetPosition():(o.options.momentum&&(n=!0===o.scrollX?o.momentum(o.x-o.scrollStartX,l,o.options.bounce?-o.x+o.scrollWidth/5:-o.x,o.options.bounce?o.x+o.scrollerWidth-o.scrollWidth+o.scrollWidth/5:o.x+o.scrollerWidth-o.scrollWidth):{dist:0,time:0},r=!0===o.scrollY?o.momentum(o.y-o.scrollStartY,l,o.options.bounce?-o.y+o.scrollHeight/5:-o.y,o.options.bounce?(o.maxScrollY<0?o.y+o.scrollerHeight-o.scrollHeight:0)+o.scrollHeight/5:o.y+o.scrollerHeight-o.scrollHeight):{dist:0,time:0},c=Math.max(Math.max(n.time,r.time),1),h=o.x+n.dist,d=o.y+r.dist),o.options.snap&&(h=(s=o.snap(h,d)).x,d=s.y,c=Math.max(s.time,c)),o.scrollTo(h,d,c+"ms"));else if(o.resetPosition(),a){for(e=u.target;1!=e.nodeType;)e=e.parentNode;(i=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,t.view,1,u.screenX,u.screenY,u.clientX,u.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i._fake=!0,e.dispatchEvent(i)}}},transitionEnd:function(){document.removeEventListener("webkitTransitionEnd",this,!1),this.resetPosition()},resetPosition:function(){var t=this,e=t.x,i=t.y;t.x>=0?e=0:t.x<t.maxScrollX&&(e=t.maxScrollX),t.y>=0||t.maxScrollY>0?i=0:t.y<t.maxScrollY&&(i=t.maxScrollY),e!=t.x||i!=t.y?t.scrollTo(e,i):(t.moved&&(t.onScrollEnd(),t.moved=!1),t.scrollBarX&&t.scrollBarX.hide(),t.scrollBarY&&t.scrollBarY.hide())},snap:function(t,e){var i=this;return t=i.directionX>0?Math.floor(t/i.scrollWidth):i.directionX<0?Math.ceil(t/i.scrollWidth):Math.round(t/i.scrollWidth),i.pageX=-t,(t*=i.scrollWidth)>0?t=i.pageX=0:t<i.maxScrollX&&(i.pageX=i.maxPageX,t=i.maxScrollX),e=i.directionY>0?Math.floor(e/i.scrollHeight):i.directionY<0?Math.ceil(e/i.scrollHeight):Math.round(e/i.scrollHeight),i.pageY=-e,(e*=i.scrollHeight)>0?e=i.pageY=0:e<i.maxScrollY&&(i.pageY=i.maxPageY,e=i.maxScrollY),{x:t,y:e,time:Math.round(Math.max(Math.abs(i.x-t)/i.scrollWidth*500,Math.abs(i.y-e)/i.scrollHeight*500))}},scrollTo:function(t,e,i){var n=this;n.x!=t||n.y!=e?(n.moved=!0,n.setTransitionTime(i||"350ms"),n.setPosition(t,e),"0"===i||"0s"==i||"0ms"==i?n.resetPosition():document.addEventListener("webkitTransitionEnd",n,!1)):n.resetPosition()},scrollToPage:function(t,e,i){var n,a=this;a.options.snap||(a.pageX=-Math.round(a.x/a.scrollWidth),a.pageY=-Math.round(a.y/a.scrollHeight)),"next"==t?t=++a.pageX:"prev"==t&&(t=--a.pageX),"next"==e?e=++a.pageY:"prev"==e&&(e=--a.pageY),t=-t*a.scrollWidth,e=-e*a.scrollHeight,t=(n=a.snap(t,e)).x,e=n.y,a.scrollTo(t,e,i||"500ms")},scrollToElement:function(t,e){if(t="object"==typeof t?t:this.element.querySelector(t)){var i=this,n=i.scrollX?-t.offsetLeft:0,a=i.scrollY?-t.offsetTop:0;n>=0?n=0:n<i.maxScrollX&&(n=i.maxScrollX),a>=0?a=0:a<i.maxScrollY&&(a=i.maxScrollY),i.scrollTo(n,a,e)}},momentum:function(t,e,i,n){var a,r=Math.abs(t)/e*1e3,s=r*r/2.5/1e3;return t>0&&s>i?(r=r*i/s/2.5,s=i):t<0&&s>n&&(r=r*n/s/2.5,s=n),s*=t<0?-1:1,a=r/1.2,{dist:Math.round(s),time:Math.round(a)}},destroy:function(t){var e=this;return window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",e,!1),e.element.removeEventListener(r,e,!1),e.element.removeEventListener(s,e,!1),e.element.removeEventListener(o,e,!1),document.removeEventListener("webkitTransitionEnd",e,!1),e.options.checkDOMChanges&&e.element.removeEventListener("DOMSubtreeModified",e,!1),e.scrollBarX&&(e.scrollBarX=e.scrollBarX.remove()),e.scrollBarY&&(e.scrollBarY=e.scrollBarY.remove()),t&&e.wrapper.parentNode.removeChild(e.wrapper),null}},e.prototype={init:function(t,e){var i,n=this,a=document,r=Math.PI;"horizontal"==n.dir?n.maxSize!=n.wrapper.offsetWidth&&(n.maxSize=n.wrapper.offsetWidth,(i=a.getCSSCanvasContext("2d","scrollbar"+n.uid+n.dir,n.maxSize,5)).fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r/2,-r/2,!1),i.lineTo(n.maxSize-2.5,0),i.arc(n.maxSize-2.5,2.5,2.5,-r/2,r/2,!1),i.closePath(),i.fill()):n.maxSize!=n.wrapper.offsetHeight&&(n.maxSize=n.wrapper.offsetHeight,(i=a.getCSSCanvasContext("2d","scrollbar"+n.uid+n.dir,5,n.maxSize)).fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r,0,!1),i.lineTo(5,n.maxSize-2.5),i.arc(2.5,n.maxSize-2.5,2.5,0,r,!1),i.closePath(),i.fill()),n.size=Math.max(Math.round(n.maxSize*n.maxSize/e),6),n.maxScroll=n.maxSize-n.size,n.toWrapperProp=n.maxScroll/(t-e),n.bar.style["horizontal"==n.dir?"width":"height"]=n.size+"px"},setPosition:function(t){var e=this;"1"!=e.wrapper.style.opacity&&e.show(),(t=Math.round(e.toWrapperProp*t))<0?(t=e.shrink?t+3*t:0,e.size+t<7&&(t=6-e.size)):t>e.maxScroll&&(t=e.shrink?t+3*(t-e.maxScroll):e.maxScroll,e.size+e.maxScroll-t<7&&(t=e.size+e.maxScroll-6)),t="horizontal"==e.dir?l+t+"px,0"+u:l+"0,"+t+"px"+u,e.bar.style.webkitTransform=t},show:function(){i&&(this.wrapper.style.webkitTransitionDelay="0"),this.wrapper.style.opacity="1"},hide:function(){i&&(this.wrapper.style.webkitTransitionDelay="350ms"),this.wrapper.style.opacity="0"},remove:function(){return this.wrapper.parentNode.removeChild(this.wrapper),null}};var i="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,n=/iphone|ipad/gi.test(navigator.appVersion),a="ontouchstart"in window,r=a?"touchstart":"mousedown",s=a?"touchmove":"mousemove",o=a?"touchend":"mouseup",l="translate"+(i?"3d(":"("),u=i?",0)":")",c=0;window.iScroll=t}(),function(){"use strict";var t=JSON.parse(document.currentScript.dataset.data||"null"),e=JSON.parse(document.currentScript.dataset.items||"null"),i=document.createElement("script");i.src="https://www.google-analytics.com/analytics.js",i.async=!0,document.head.appendChild(i),window.ga=window.ga||function(){var t=Array.prototype.slice.call(arguments);return(ga.q=ga.q||[]).push(t)},window.Analytics={properties:[],call_queue:[],test_ids:["UA-4189134-10","UA-4189134-13"],live_ids:["UA-4189134-2","UA-4189134-11"],environments:{0:{sample_rate:100},1:{sample_rate:100,cookie_domain:"staging.bcdevs.com"},2:{sample_rate:8,use_live_ids:!0,cookie_domain:"bandcamp.com"}},dimensions:{LOGIN_STATE:"dimension1",CLIENT_ID:"dimension2"},metrics:{RESPONSE_END_TIME:"metric1",DOM_LOAD_TIME:"metric2",WINDOW_LOAD_TIME:"metric3"},currentCurrency:"USD",data:null,inited:!1,ecommerce:!1,init:function(){if(this.data=t||window.AnalyticsData,this.data&&!this.inited){Identities.bmgr.bands().length>0?this.data.login_state="logged_in_band":Identities.user()?this.data.login_state="logged_in_user":this.data.login_state="not_logged_in";var e=this.environments[this.data.env];this.data.sample_rate=e.sample_rate,this.data.our_ids||(this.data.our_ids=e.use_live_ids?this.live_ids:this.test_ids),this.data.cookie_domain=this.data.domain_match?this.data.cookie_domain||e.cookie_domain:"auto",this.inited=!0;var i=this.data.send_full_url;this.split=window.location.href.split("?"),this.params=this.split[1]&&this.split[1].split("&");var n=[];this.params=this.params&&this.params.filter((function(t){var e="utm_"===t.substr(0,4),a="email="!==t.substr(0,6);return e&&n.push(t.split("=")[0]),i?a:e})),n.length>0&&HiddenParams.hide(n);var a=0;this.data.our_ids.forEach((function(t){this.properties.push(this.createPropertySendPageview(t,!0,a)),a++}),this),this.data.band_id&&this.createPropertySendPageview(this.data.band_id,!1,a),this.collectClientIds(),this.sendCheckoutItems(),this.sendTimings(),this.processQueuedEvents()}},createPropertySendPageview:function(t,e,i){var n=(e?"bandcamp_":"band_")+i,a={name:n};e&&(a.cookieDomain=this.data.cookie_domain,a.sampleRate=this.data.sample_rate),ga("create",t,a);var r={id:t,ours:e,name:n,call:function(){var t=Array.prototype.slice.call(arguments);t[0]=r.name+"."+t[0],ga.apply(window,t)}};if(r.call("set","anonymizeIp",!0),r.call("set","forceSSL",!0),r.call("set","transport","beacon"),e&&r.call("set",this.dimensions.LOGIN_STATE,this.data.login_state),this.params){var s=this.params.length>0?"?"+this.params.join("&"):"",o=this.data.send_full_url?window.location.pathname+s:window.location.pathname;r.call("set","page",o),r.call("set","location",this.split[0]+s)}return r.call("send","pageview"),r},collectClientIds:function(){var t=this;ga((function(){for(var e=window.Analytics.properties,i=ga.getAll(),n=0;n<i.length;n++)for(var a=i[n].get("trackingId"),r=i[n].get("clientId"),s=0;s<e.length;s++){var o=e[s];o.id===a&&o.call("set",t.dimensions.CLIENT_ID,r)}}))},sendCheckoutItems:function(){var t=e||window.AnalyticsItems;if(t&&0!=t.length){var i={};t.forEach((function(t){(i[t.payment_id]=i[t.payment_id]||[]).push(t)}));var n=!1;if("undefined"!=typeof URLSearchParams){var a=Url.parseQuery(window.location.search);n=a&&a.always_send_txns}for(var r="analytics_processed_ids",s=JSON.parse(localStorage.getItem(r)||"[]"),o=[],l=0,u=Object.keys(i);l<u.length;l++)(n||-1===s.indexOf(u[l]))&&o.push(u[l]);if(0!=o.length){var c={};o.forEach((function(t){i[t].forEach((function(t){var e=t.txn_id.slice();delete t.payment_id,delete t.txn_id,null==c[e]&&(c[e]=[]),c[e].push(t)}))})),this.requireEcommerce();var h=this;Object.keys(c).forEach((function(t){c[t].forEach((function(t){h.setCurrency(t.currency),delete t.currency,h.callOurProperties("ec:addProduct",t)})),h.callOurProperties("ec:setAction","purchase",{id:t})})),s=s.slice(Math.max(s.length-1e3,0)),localStorage.setItem(r,JSON.stringify(s.concat(o)))}}},sendTimings:function(){if(window.performance&&window.performance.timing)if("complete"==document.readyState){var t,e=performance.timing,i=e.navigationStart,n=Math.round(e.responseEnd-i),a=Math.round(e.domContentLoadedEventStart-i),r=Math.round(e.loadEventStart-i);if(t=!0,[n,a,r].forEach((function(e){(e<=0||e>=1e6)&&(t=!1)})),t){var s={eventCategory:"Navigation Timing",eventAction:"track",nonInteraction:!0};s[this.metrics.RESPONSE_END_TIME]=n,s[this.metrics.DOM_LOAD_TIME]=a,s[this.metrics.WINDOW_LOAD_TIME]=r,this.callOurProperties("send","event",s)}}else window.addEventListener("load",(function(){window.Analytics.sendTimings()}))},processQueuedEvents:function(){for(;this.call_queue.length>0;)this.callOurProperties.apply(this,this.call_queue.shift())},callOurProperties:function(){var t=Array.prototype.slice.call(arguments);this.inited?this.properties.forEach((function(e){e.ours&&e.call.apply(null,t)})):this.call_queue.push(t)},setCurrency:function(t){t&&t!=this.currentCurrency&&(this.callOurProperties("set","currencyCode",t),this.currentCurrency=t)},cartItemEvent:function(t,e){var i="add"==t;this.requireEcommerce(),this.setCurrency(e.currency),this.callOurProperties("ec:addProduct",{id:e.item_type+e.item_id,name:e.item_title,category:e.item_type,price:e.unit_price,variant:e.is_gift?"gift":"_none",quantity:e.quantity}),this.callOurProperties("ec:setAction",i?"add":"remove"),this.callOurProperties("send","event","Checkout",i?"add_to_cart":"remove_from_cart",e.item_type,e.item_id)},requireEcommerce:function(){this.ecommerce||(this.callOurProperties("require","ec"),this.ecommerce=!0)}},window.Analytics.init()}();
